<?php
return unserialize("a:5:{i:0;a:1:{i:0;a:1:{i:0;a:5:{i:0;s:33:\"tcpfunc_5abfcf2ebc5286.25507661_1\";i:1;a:0:{}i:2;i:1;i:3;s:0:\"\";i:4;s:0:\"\";}}}i:1;a:1:{i:0;a:4:{i:0;a:0:{}i:1;i:4;i:2;s:7:\"INCLUDE\";i:3;a:3:{i:0;s:16:\"WYSIWYG_SETTINGS\";i:1;s:3:\".js\";i:2;s:10:\"javascript\";}}}i:2;s:7:\"editing\";i:3;N;i:4;a:1:{s:33:\"tcpfunc_5abfcf2ebc5286.25507661_1\";s:39408:\"\$tpl_funcs['tcpfunc_5abfcf2ebc5286.25507661_1']=\$KEEP_TPL_FUNCS['tcpfunc_5abfcf2ebc5286.25507661_1']=recall_named_function('5abfcf2ebc5605.86400452','\$parameters,\$cl',\"echo \\\"\\\\\\\"use strict\\\\\\\";\\\\n\\\\n/* Form editing code (general, may be used on many different kinds of form) */\\\\n\\\\n// ===========\\\\n// HTML EDITOR\\\\n// ===========\\\\n\\\\nif (typeof window.CKEDITOR=='undefined')\\\\n{\\\\n	window.CKEDITOR=null;\\\\n}\\\\n\\\\nfunction wysiwyg_cookie_says_on()\\\\n{\\\\n	var cookie=read_cookie('use_wysiwyg');\\\\n	return ((cookie=='') || (cookie!='0')) && (browser_matches('wysiwyg') && ('\\\",\\n	ecv_MOBILE(\\\$cl,array(),array()),\\n	\\\"'!='1'));\\\\n}\\\\n\\\\nfunction wysiwyg_on()\\\\n{\\\\n	return wysiwyg_cookie_says_on();\\\\n}\\\\n\\\\nfunction toggle_wysiwyg(name)\\\\n{\\\\n	if (!browser_matches('wysiwyg'))\\\\n	{\\\\n		window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:TOGGLE_WYSIWYG_ERROR\\\",array()),\\n	\\\"');\\\\n		return false;\\\\n	}\\\\n\\\\n	if (typeof window.do_ajax_request=='undefined') return false;\\\\n	if (typeof window.merge_text_nodes=='undefined') return false;\\\\n	if (typeof window.get_elements_by_class_name=='undefined') return false;\\\\n\\\\n	var is_wysiwyg_on=wysiwyg_on();\\\\n	if (is_wysiwyg_on)\\\\n	{\\\\n		if (read_cookie('use_wysiwyg')=='-1')\\\\n		{\\\\n			_toggle_wysiwyg(name);\\\\n		} else\\\\n		{\\\\n			generate_question_ui(\\\\n				'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:WHETHER_SAVE_WYSIWYG_SELECTION\\\",array()),\\n	\\\"',\\\\n				{\\\\n					buttons__cancel: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"',\\\\n					buttons__clear: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:WYSIWYG_DISABLE_ONCE\\\",array()),\\n	\\\"',\\\\n					//buttons__no: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:WYSIWYG_DISABLE_ONCE_AND_DONT_ASK\\\",array()),\\n	\\\"',		Too confusing, re-enable if you want it\\\\n					buttons__yes: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:WYSIWYG_DISABLE_ALWAYS\\\",array()),\\n	\\\"'\\\\n				},\\\\n				'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:DISABLE_WYSIWYG\\\",array()),\\n	\\\"',\\\\n				'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:DISCARD_WYSIWYG_CHANGES\\\",array()),\\n	\\\"',\\\\n				function(saving_cookies)\\\\n				{\\\\n					if (!saving_cookies) return;\\\\n\\\\n					if (saving_cookies.toLowerCase()=='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:WYSIWYG_DISABLE_ONCE\\\",array()),\\n	\\\"'.toLowerCase())\\\\n					{\\\\n						_toggle_wysiwyg(name);\\\\n					}\\\\n\\\\n					if (saving_cookies.toLowerCase()=='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:WYSIWYG_DISABLE_ONCE_AND_DONT_ASK\\\",array()),\\n	\\\"'.toLowerCase())\\\\n					{\\\\n						_toggle_wysiwyg(name);\\\\n						set_cookie('use_wysiwyg','-1',3000);\\\\n					}\\\\n\\\\n					if (saving_cookies.toLowerCase()=='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:WYSIWYG_DISABLE_ALWAYS\\\",array()),\\n	\\\"'.toLowerCase())\\\\n					{\\\\n						_toggle_wysiwyg(name);\\\\n						set_cookie('use_wysiwyg','0',3000);\\\\n					}\\\\n				},\\\\n				600,\\\\n				140\\\\n			);\\\\n		}\\\\n		return false;\\\\n	}\\\\n\\\\n	var ret=_toggle_wysiwyg(name);\\\\n	if (read_cookie('use_wysiwyg')!='-1')\\\\n		set_cookie('use_wysiwyg','1',3000);\\\\n	return ret;\\\\n}\\\\n\\\\nfunction _toggle_wysiwyg(name)\\\\n{\\\\n	var is_wysiwyg_on=wysiwyg_on();\\\\n\\\\n	var forms=document.getElementsByTagName('form');\\\\n	var so=document.getElementById('post_special_options');\\\\n	var so2=document.getElementById('post_special_options2');\\\\n\\\\n	if (is_wysiwyg_on)\\\\n	{\\\\n		// Find if the WYSIWYG has anything in it - if not, discard\\\\n		var all_empty=true,myregexp=new RegExp(/((\\\\\\\\s)|(<p\\\\\\\\d*\\\\\\\\/>)|(<\\\\\\\\/p>)|(<p>)|(&nbsp;)|(<br[^>]*>))*/);\\\\n		for (var fid=0;fid<forms.length;fid++)\\\\n		{\\\\n			for (var counter=0;counter<forms[fid].elements.length;counter++)\\\\n			{\\\\n				var id=forms[fid].elements[counter].id;\\\\n				if (typeof window.wysiwyg_editors[id]!='undefined')\\\\n				{\\\\n					if (window.wysiwyg_editors[id].getData().replace(myregexp,'')!='') all_empty=false;\\\\n				}\\\\n			}\\\\n		}\\\\n\\\\n		if (all_empty)\\\\n		{\\\\n			disable_wysiwyg(forms,so,so2,true);\\\\n		} else\\\\n		if ((typeof window.wysiwyg_original_comcode[id]=='undefined') || (window.wysiwyg_original_comcode[id].indexOf('&#8203;')!=-1) || (window.wysiwyg_original_comcode[id].indexOf('cms_keep')!=-1))\\\\n		{\\\\n			disable_wysiwyg(forms,so,so2,false);\\\\n		} else\\\\n		{\\\\n			generate_question_ui(\\\\n				'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:DISCARD_WYSIWYG_CHANGES_NICE\\\",array()),\\n	\\\"',\\\\n				{buttons__cancel: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"',buttons__convert: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:DISCARD_WYSIWYG_CHANGES_LINE_CONVERT\\\",array()),\\n	\\\"',buttons__no: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:DISCARD_WYSIWYG_CHANGES_LINE\\\",array()),\\n	\\\"'},\\\\n				'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:DISABLE_WYSIWYG\\\",array()),\\n	\\\"',\\\\n				'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:DISCARD_WYSIWYG_CHANGES\\\",array()),\\n	\\\"',\\\\n				function(prompt)\\\\n				{\\\\n					if ((!prompt) || (prompt.toLowerCase()=='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"'.toLowerCase()))\\\\n					{\\\\n						if (read_cookie('use_wysiwyg')=='0')\\\\n							set_cookie('use_wysiwyg','1',3000);\\\\n						return false;\\\\n					}\\\\n					var discard=(prompt.toLowerCase()=='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:DISCARD_WYSIWYG_CHANGES_LINE\\\",array()),\\n	\\\"'.toLowerCase());\\\\n\\\\n					disable_wysiwyg(forms,so,so2,discard);\\\\n				}\\\\n			);\\\\n		}\\\\n	} else\\\\n	{\\\\n		enable_wysiwyg(forms,so,so2);\\\\n	}\\\\n\\\\n	return false;\\\\n}\\\\n\\\\nfunction enable_wysiwyg(forms,so,so2)\\\\n{\\\\n	window.wysiwyg_on=function() { return true; };\\\\n\\\\n	for (var fid=0;fid<forms.length;fid++)\\\\n	{\\\\n		load_html_edit(forms[fid],true);\\\\n	}\\\\n}\\\\n\\\\nfunction disable_wysiwyg(forms,so,so2,discard)\\\\n{\\\\n	for (var fid=0;fid<forms.length;fid++)\\\\n	{\\\\n		for (var counter=0;counter<forms[fid].elements.length;counter++)\\\\n		{\\\\n			var id=forms[fid].elements[counter].id;\\\\n			if (typeof window.wysiwyg_editors[id]!='undefined')\\\\n			{\\\\n				var textarea=forms[fid].elements[counter];\\\\n\\\\n				// Mark as non-WYSIWYG\\\\n				document.getElementById(id+'__is_wysiwyg').value='0';\\\\n				textarea.style.display='block';\\\\n				textarea.style.visibility='visible';\\\\n				textarea.disabled=false;\\\\n				textarea.readOnly=false;\\\\n\\\\n				if (typeof window.rebuild_attachment_button_for_next!='undefined')\\\\n					rebuild_attachment_button_for_next(id,'attachment_upload_button');\\\\n\\\\n				// Unload editor\\\\n				var wysiwyg_data=window.wysiwyg_editors[id].getData();\\\\n				try\\\\n				{\\\\n					window.wysiwyg_editors[id].destroy();\\\\n				}\\\\n				catch (e) {}\\\\n				delete window.wysiwyg_editors[id];\\\\n\\\\n				// Comcode conversion\\\\n				if ((discard) && (window.wysiwyg_original_comcode[id]))\\\\n				{\\\\n					textarea.value=window.wysiwyg_original_comcode[id];\\\\n				} else\\\\n				{\\\\n					var url=maintain_theme_in_link('\\\",\\n	ecv_FIND_SCRIPT_NOHTTP(\\\$cl,array(2),array(\\\"comcode_convert\\\")),\\n	\\\"?from_html=1'+keep_stub());\\\\n					if (window.location.href.indexOf('topics')!=-1) url+='&forum_db=1';\\\\n					var post='data='+window.encodeURIComponent(wysiwyg_data.replace(new RegExp(String.fromCharCode(8203),'g'),''));\\\\n					post=modsecurity_workaround_ajax(post);\\\\n					var request=do_ajax_request(url,null,post);\\\\n					if ((!request.responseXML) || (!request.responseXML.documentElement.getElementsByTagName('result')[0]))\\\\n					{\\\\n						textarea.value='[semihtml]'+wysiwyg_data+'[/semihtml]';\\\\n					} else\\\\n					{\\\\n						var result_tags=request.responseXML.documentElement.getElementsByTagName('result');\\\\n						var result=result_tags[0];\\\\n						textarea.value=merge_text_nodes(result.childNodes).replace(/\\\\\\\\s*\\\\\\\$/,'');\\\\n					}\\\\n					if ((textarea.value.indexOf('{\\\\\\\\\\\\\\\$,page hint: no_wysiwyg}')==-1) && (textarea.value!='')) textarea.value+='{\\\\\\\\\\\\\\\$,page hint: no_wysiwyg}';\\\\n				}\\\\n				if (document.getElementById('toggle_wysiwyg_'+id))\\\\n					set_inner_html(document.getElementById('toggle_wysiwyg_'+id),'<img src=\\\\\\\"\\\",\\n	ecv_IMG(\\\$cl,array(1,2,8),array(\\\"icons/16x16/editor/wysiwyg_on\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"\\\\\\\" srcset=\\\\\\\"\\\",\\n	ecv_IMG(\\\$cl,array(2,8),array(\\\"icons/16x16/editor/wysiwyg_on\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\" 2x\\\\\\\" alt=\\\\\\\"\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:ENABLE_WYSIWYG\\\",array()),\\n	\\\"\\\\\\\" title=\\\\\\\"\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:ENABLE_WYSIWYG\\\",array()),\\n	\\\"\\\\\\\" class=\\\\\\\"vertical_alignment\\\\\\\" />');\\\\n\\\\n				// Unload editor\\\\n				try\\\\n				{\\\\n					window.wysiwyg_editors[id].destroy();\\\\n				}\\\\n				catch (e) {}\\\\n			}\\\\n		}\\\\n	}\\\\n	if (so) so.style.display='block';\\\\n	if (so2) so2.style.display='none';\\\\n\\\\n	window.wysiwyg_on=function() { return false; };\\\\n}\\\\n\\\\nwindow.wysiwyg_readonly_timer={};\\\\nfunction wysiwyg_set_readonly(name,readonly)\\\\n{\\\\n	if (typeof window.wysiwyg_editors[name]=='undefined')\\\\n	{\\\\n		return;\\\\n	}\\\\n\\\\n	var editor=window.wysiwyg_editors[name];\\\\n	if (editor.document && editor.document.\\\\\\\$ && editor.document.\\\\\\\$.body)\\\\n	{\\\\n		editor.document.\\\\\\\$.body.readOnly=readonly;\\\\n		editor.document.\\\\\\\$.body.contentEditable=!readonly;\\\\n		editor.document.\\\\\\\$.body.designMode=readonly?'off':'on';\\\\n	}\\\\n\\\\n	// In case it sticks as read only we need a timer to put it back. But only if not already back.\\\\n	if (typeof window.wysiwyg_readonly_timer[name]!='undefined' && window.wysiwyg_readonly_timer[name])\\\\n	{\\\\n		window.clearTimeout(window.wysiwyg_readonly_timer[name]);\\\\n		window.wysiwyg_readonly_timer[name]=null;\\\\n	}\\\\n	if (readonly)\\\\n	{\\\\n		window.wysiwyg_readonly_timer[name]=window.setTimeout(function() {\\\\n			wysiwyg_set_readonly(name,false);\\\\n		},5000);\\\\n	}\\\\n}\\\\n\\\\n// Initialising the HTML editor if requested later (i.e. toggling it to on)\\\\nif (typeof window.wysiwyg_editors=='undefined')\\\\n{\\\\n	window.wysiwyg_editors={};\\\\n	window.wysiwyg_original_comcode={};\\\\n}\\\\nfunction load_html_edit(posting_form,ajax_copy)\\\\n{\\\\n	if ((!posting_form.method) || (posting_form.method.toLowerCase()!='post')) return;\\\\n\\\\n	if (!posting_form.elements['http_referer'])\\\\n	{\\\\n		var http_referer=document.createElement('input');\\\\n		http_referer.name='http_referer';\\\\n		http_referer.value=window.location.href;\\\\n		http_referer.setAttribute('type','hidden');\\\\n		posting_form.appendChild(http_referer);\\\\n	}\\\\n\\\\n	if (typeof window.do_ajax_request=='undefined') return;\\\\n	if (typeof window.merge_text_nodes=='undefined') return;\\\\n	if (typeof window.CKEDITOR=='undefined' || window.CKEDITOR==null) return;\\\\n	if (!browser_matches('wysiwyg')) return;\\\\n	if (!wysiwyg_on()) return;\\\\n\\\\n	var so=document.getElementById('post_special_options');\\\\n	var so2=document.getElementById('post_special_options2');\\\\n	if ((!posting_form.elements['post']) || (posting_form.elements['post'].className.indexOf('wysiwyg')!=-1))\\\\n	{\\\\n		if (so) so.style.display='none';\\\\n		if (so2) so2.style.display='block';\\\\n	}\\\\n\\\\n	var counter,count=0,e,indicator,those_done=[],id;\\\\n	for (counter=0;counter<posting_form.elements.length;counter++)\\\\n	{\\\\n		e=posting_form.elements[counter];\\\\n		id=e.id;\\\\n\\\\n		if ((e.type=='textarea') && (e.className.indexOf('wysiwyg')!=-1))\\\\n		{\\\\n			if (document.getElementById(id+'__is_wysiwyg'))\\\\n			{\\\\n				indicator=document.getElementById(id+'__is_wysiwyg');\\\\n			} else\\\\n			{\\\\n				indicator=document.createElement('input');\\\\n				indicator.setAttribute('type','hidden');\\\\n				indicator.id=e.id+'__is_wysiwyg';\\\\n				indicator.name=e.name+'__is_wysiwyg';\\\\n				posting_form.appendChild(indicator);\\\\n			}\\\\n			indicator.value='1';\\\\n\\\\n			if (those_done[id]) continue;\\\\n			those_done[id]=1;\\\\n\\\\n			count++;\\\\n			if (document.getElementById('toggle_wysiwyg_'+id))\\\\n				set_inner_html(document.getElementById('toggle_wysiwyg_'+id),'<img src=\\\\\\\"\\\",\\n	ecv_IMG(\\\$cl,array(1,2,8),array(\\\"icons/16x16/editor/wysiwyg_off\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"\\\\\\\" srcset=\\\\\\\"\\\",\\n	ecv_IMG(\\\$cl,array(2,8),array(\\\"icons/32x32/editor/wysiwyg_off\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\" 2x\\\\\\\" alt=\\\\\\\"\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:DISABLE_WYSIWYG\\\",array()),\\n	\\\"\\\\\\\" title=\\\\\\\"\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:DISABLE_WYSIWYG\\\",array()),\\n	\\\"\\\\\\\" class=\\\\\\\"vertical_alignment\\\\\\\" />');\\\\n\\\\n			window.wysiwyg_original_comcode[id]=e.value;\\\\n			if (!ajax_copy)\\\\n			{\\\\n				if ((typeof posting_form.elements[id+'_parsed']!='undefined') && (posting_form.elements[id+'_parsed'].value!='') && ((e.defaultValue==''/*IE bug*/) || (e.defaultValue==e.value))) // The extra conditionals are for if back button used\\\\n					e.value=posting_form.elements[id+'_parsed'].value;\\\\n			} else\\\\n			{\\\\n				var url=maintain_theme_in_link('\\\",\\n	ecv_FIND_SCRIPT_NOHTTP(\\\$cl,array(2),array(\\\"comcode_convert\\\")),\\n	\\\"?semihtml=1&from_html=0'+keep_stub());\\\\n				if (window.location.href.indexOf('topics')!=-1) url+='&forum_db=1';\\\\n				var request=do_ajax_request(url,null,'data='+window.encodeURIComponent(posting_form.elements[counter].value.replace(new RegExp(String.fromCharCode(8203),'g'),'').replace('{'+'\\\\\\\$,page hint: no_wysiwyg}','')));\\\\n				if (!request.responseXML)\\\\n				{\\\\n					posting_form.elements[counter].value='';\\\\n				} else\\\\n				{\\\\n					var result_tags=request.responseXML.documentElement.getElementsByTagName('result');\\\\n					if ((!result_tags) || (result_tags.length==0))\\\\n					{\\\\n						posting_form.elements[counter].value='';\\\\n					} else\\\\n					{\\\\n						var result=result_tags[0];\\\\n						posting_form.elements[counter].value=merge_text_nodes(result.childNodes);\\\\n					}\\\\n				}\\\\n			}\\\\n			window.setTimeout(function(e,id) {\\\\n				return function() {\\\\n					wysiwyg_editor_init_for(e,id);\\\\n				}\\\\n			}(e,id),1000);\\\\n		}\\\\n	}\\\\n}\\\\n\\\\nfunction wysiwyg_editor_init_for(element,id)\\\\n{\\\\n	var page_stylesheets=[];\\\\n	if (!document) return;\\\\n	var linked_sheets=document.getElementsByTagName('link');\\\\n	for (var counter=0;counter<linked_sheets.length;counter++)\\\\n	{\\\\n		if (linked_sheets[counter].getAttribute('rel')=='stylesheet')\\\\n			page_stylesheets.push(linked_sheets[counter].getAttribute('href'));\\\\n	}\\\\n\\\\n	// Fiddly procedure to find our colour\\\\n	var test_div=document.createElement('div');\\\\n	document.body.appendChild(test_div);\\\\n	test_div.className='wysiwyg_toolbar_color_finder';\\\\n	var matches;\\\\n	var wysiwyg_color=abstract_get_computed_style(test_div,'color');\\\\n	test_div.parentNode.removeChild(test_div);\\\\n	matches=wysiwyg_color.match(/^rgb\\\\\\\\((\\\\\\\\d+),\\\\\\\\s*(\\\\\\\\d+),\\\\\\\\s*(\\\\\\\\d+)\\\\\\\\)\\\\\\\$/,matches);\\\\n	if (matches)\\\\n	{\\\\n		wysiwyg_color='#';\\\\n		var hex;\\\\n		hex=(window.parseInt(matches[1]).toString(16))+'';\\\\n		if (hex.length==1) hex='0'+hex;\\\\n		wysiwyg_color+=hex;\\\\n		hex=(window.parseInt(matches[2]).toString(16))+'';\\\\n		if (hex.length==1) hex='0'+hex;\\\\n		wysiwyg_color+=hex;\\\\n		hex=(window.parseInt(matches[3]).toString(16))+'';\\\\n		if (hex.length==1) hex='0'+hex;\\\\n		wysiwyg_color+=hex;\\\\n	}\\\\n	// CKEditor doesn't allow low saturation, so raise up if we need to\\\\n	matches=wysiwyg_color.match(/^#([0-4])(.)([0-4])(.)([0-4])(.)\\\\\\\$/);\\\\n	if (matches)\\\\n	{\\\\n		wysiwyg_color='#';\\\\n		wysiwyg_color+=(window.parseInt(matches[1])+4)+matches[2];\\\\n		wysiwyg_color+=(window.parseInt(matches[3])+4)+matches[4];\\\\n		wysiwyg_color+=(window.parseInt(matches[5])+4)+matches[6];\\\\n	}\\\\n\\\\n	\\\",\\n	ecv(\\\$cl,array(),4,\\\"INCLUDE\\\",array(\\\"WYSIWYG_SETTINGS\\\",\\\".js\\\",\\\"javascript\\\",\\\"\\\",'vars'=>\\\$parameters)),\\n	\\\"\\\\n\\\\n	if (typeof window.CKEDITOR.instances[element.id]!='undefined' && window.CKEDITOR.instances[element.id])\\\\n		delete window.CKEDITOR.instances[element.id]; // Workaround \\\\\\\"The instance \\\\\\\"xxx\\\\\\\" already exists\\\\\\\" error in Google Chrome\\\\n	var editor=window.CKEDITOR.replace(element.id,editor_settings);\\\\n	if (!editor) return; // Not supported on this platform\\\\n	window.wysiwyg_editors[id]=editor;\\\\n\\\\n	element.parentNode.className+=' '+editor_settings.skin; // Used for us to target per-skin CSS\\\\n\\\\n	// CSS to run inside the CKEditor frame\\\\n	linked_sheets=document.getElementsByTagName('style');\\\\n	var css='';\\\\n	for (counter=0;counter<linked_sheets.length;counter++)\\\\n	{\\\\n		css+=get_inner_html(linked_sheets[counter]);\\\\n	}\\\\n	window.CKEDITOR.addCss(css);\\\\n\\\\n	// Change some CKEditor defaults\\\\n	window.CKEDITOR.on('dialogDefinition',function(ev) {\\\\n		var dialogName=ev.data.name;\\\\n		var dialogDefinition=ev.data.definition;\\\\n\\\\n		if (dialogName=='table') {\\\\n			var info=dialogDefinition.getContents('info');\\\\n\\\\n			info.get('txtWidth')['default']='100%';\\\\n			info.get('txtBorder')['default']='0';\\\\n			info.get('txtBorder')['default']='0';\\\\n			info.get('txtCellSpace')['default']='0';\\\\n			info.get('txtCellPad')['default']='0';\\\\n		}\\\\n	});\\\\n	if (document.getElementById('attachment_store'))\\\\n		window.lang_PREFER_CMS_ATTACHMENTS='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:PREFER_CMS_ATTACHMENTS\\\",array()),\\n	\\\"';\\\\n	window.lang_SPELLCHECKER_ENABLED='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:SPELLCHECKER_ENABLED\\\",array()),\\n	\\\"';\\\\n	window.lang_SPELLCHECKER_DISABLED='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:SPELLCHECKER_DISABLED\\\",array()),\\n	\\\"';\\\\n	window.lang_SPELLCHECKER_TOGGLE='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:SPELLCHECKER_TOGGLE\\\",array()),\\n	\\\"';\\\\n	window.lang_SPELLCHECKER_LABEL='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:SPELLCHECKER_LABEL\\\",array()),\\n	\\\"';\\\\n	window.lang_NO_IMAGE_PASTE_SAFARI='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:NO_IMAGE_PASTE_SAFARI\\\",array()),\\n	\\\"';\\\\n\\\\n	// Mainly used by autosaving, but also sometimes CKEditor seems to not refresh the textarea (e.g. for one user's site when pressing delete key on an image)\\\\n	var sync=function (event) {\\\\n		if (typeof element.externalOnKeyPress!='undefined')\\\\n		{\\\\n			element.value=editor.getData();\\\\n			element.externalOnKeyPress(event,element);\\\\n		}\\\\n	};\\\\n	editor.on('change',sync);\\\\n	editor.on('mode',function() {\\\\n		var ta=editor.container.\\\\\\\$.getElementsByTagName('textarea');\\\\n		if (typeof ta[0]!='undefined')\\\\n			ta[0].onchange=sync; // The source view doesn't fire the 'change' event and we don't want to use the 'key' event\\\\n	});\\\\n\\\\n	editor.on('instanceReady', function (event) {\\\\n		editor.setReadOnly(false); // Workaround for CKEditor bug found in 4.5.6, where it started sometimes without contentEditable=true\\\\n\\\\n		if (typeof window.set_up_comcode_autocomplete!='undefined')\\\\n		{\\\\n			set_up_comcode_autocomplete(id);\\\\n		}\\\\n\\\\n		// Instant preview of Comcode\\\\n		find_tags_in_editor(editor,element);\\\\n	});\\\\n	window.setInterval(function() {\\\\n		if (is_wysiwyg_field(element))\\\\n			find_tags_in_editor(editor,element);\\\\n	}, 1000);\\\\n\\\\n	// Weird issues in Chrome cutting+pasting blocks etc\\\\n	editor.on('paste', function (event) {\\\\n		if (event.data.html)\\\\n		{\\\\n			event.data.html=event.data.html.replace(/<meta charset=\\\\\\\"utf-8\\\\\\\">/g,'');\\\\n			event.data.html=event.data.html.replace(/<br class=\\\\\\\"Apple-interchange-newline\\\\\\\">/g,'<br>');\\\\n			event.data.html=event.data.html.replace(/<div style=\\\\\\\"text-align: center;\\\\\\\"><font class=\\\\\\\"Apple-style-span\\\\\\\" face=\\\\\\\"'Lucida Grande'\\\\\\\"><span class=\\\\\\\"Apple-style-span\\\\\\\" style=\\\\\\\"font-size: 11px; white-space: pre;\\\\\\\"><br><\\\\\\\\/span><\\\\\\\\/font><\\\\\\\\/div>\\\\\\\$/,'<br><br>');\\\\n		}\\\\n	});\\\\n\\\\n	// Allow drag and drop uploading\\\\n	editor.on('contentDom',function() {\\\\n		editor.document.on('dragover',function(e) {\\\\n			html5_upload_event_drag_over(e.data.\\\\\\\$,element,element.id);\\\\n		});\\\\n\\\\n		editor.document.on('drop',function(e) {\\\\n			html5_upload_event_drop(e.data.\\\\\\\$,element,element.id);\\\\n		});\\\\n	});\\\\n\\\\n	return editor;\\\\n}\\\\n\\\\nfunction find_tags_in_editor(editor,element)\\\\n{\\\\n	if (!editor.document) return;\\\\n	if (typeof editor.document.\\\\\\\$=='undefined') return;\\\\n	if (!editor.document.\\\\\\\$) return;\\\\n\\\\n	var comcodes=get_elements_by_class_name(editor.document.\\\\\\\$.getElementsByTagName('body')[0],'cms_keep_ui_controlled');\\\\n\\\\n	for (var i=0;i<comcodes.length;i++)\\\\n	{\\\\n		if (!comcodes[i].onmouseout)\\\\n		{\\\\n			comcodes[i].orig_title=comcodes[i].title;\\\\n			comcodes[i].onmouseout=function() {\\\\n				if (typeof window.deactivate_tooltip!='undefined') deactivate_tooltip(this);\\\\n			};\\\\n			comcodes[i].onmousemove=function(event) {\\\\n				if (typeof event=='undefined') event=editor.window.\\\\\\\$.event;\\\\n\\\\n				var eventCopy={};\\\\n				if (event)\\\\n				{\\\\n					if (event.pageX) eventCopy.pageX=3000;\\\\n					if (event.clientX) eventCopy.clientX=3000;\\\\n					if (event.pageY) eventCopy.pageY=3000;\\\\n					if (event.clientY) eventCopy.clientY=3000;\\\\n\\\\n					if (typeof window.activate_tooltip!='undefined' && typeof this.orig_title!='undefined')\\\\n					{\\\\n						reposition_tooltip(this,eventCopy);\\\\n						this.title=this.orig_title;\\\\n					}\\\\n				}\\\\n			};\\\\n			comcodes[i].onmousedown=function(event) {\\\\n				if (typeof event=='undefined') event=editor.window.\\\\\\\$.event;\\\\n\\\\n				if (event.altKey)\\\\n				{\\\\n					// Mouse cursor to start\\\\n					var range=document.selection.getRanges()[0];\\\\n					range.startOffset=0;\\\\n					range.endOffset=0;\\\\n					range.select();\\\\n					document.selection.selectRanges([range]);\\\\n				}\\\\n			};\\\\n			if (comcodes[i].nodeName.toLowerCase()=='input')\\\\n			{\\\\n				comcodes[i].readOnly=true;\\\\n				comcodes[i].contentEditable=true; // Undoes what ckeditor sets. Fixes weirdness with copy and paste in Chrome (adding extra block on end)\\\\n				comcodes[i].ondblclick=function(event) {\\\\n					if (this.onmouseout) this.onmouseout();\\\\n					var field_name=editor.name;\\\\n					if ((typeof window.event!='undefined') && (window.event)) window.event.returnValue=false;\\\\n					if (this.id=='') this.id='comcode_tag_'+Math.round(Math.random()*10000000);\\\\n					var tag_type=this.title.replace(/^\\\\\\\\[/,'').replace(/[= \\\\\\\\]](.|\\\\\\\\n)*\\\\\\\$/,'');\\\\n					if (tag_type=='block')\\\\n					{\\\\n						var block_name=this.title.replace(/\\\\\\\\[\\\\\\\\/block\\\\\\\\]\\\\\\\$/,'').replace(/^(.|\\\\\\\\s)*\\\\\\\\]/,'');\\\\n						var url='\\\",\\n	ecv_FIND_SCRIPT(\\\$cl,array(2),array(\\\"block_helper\\\")),\\n	\\\"?type=step2&block='+window.encodeURIComponent(block_name)+'&field_name='+field_name+'&parse_defaults='+window.encodeURIComponent(this.title)+'&save_to_id='+window.encodeURIComponent(this.id)+keep_stub();\\\\n						url=url+'&block_type='+(((field_name.indexOf('edit_panel_')==-1) && (window.location.href.indexOf(':panel_')==-1))?'main':'side');\\\\n						window.faux_open(maintain_theme_in_link(url),'','width=750,height=auto,status=no,resizable=yes,scrollbars=yes',null,'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"');\\\\n					} else\\\\n					{\\\\n						var url='\\\",\\n	ecv_FIND_SCRIPT(\\\$cl,array(2),array(\\\"comcode_helper\\\")),\\n	\\\"?type=step2&tag='+window.encodeURIComponent(tag_type)+'&field_name='+field_name+'&parse_defaults='+window.encodeURIComponent(this.title)+'&save_to_id='+window.encodeURIComponent(this.id)+keep_stub();\\\\n						window.faux_open(maintain_theme_in_link(url),'','width=750,height=auto,status=no,resizable=yes,scrollbars=yes',null,'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"');\\\\n					}\\\\n					return false;\\\\n				}\\\\n			}\\\\n			comcodes[i].onmouseover=function(event) { // Shows preview\\\\n				if (typeof event=='undefined') event=editor.window.\\\\\\\$.event;\\\\n\\\\n				cancel_bubbling(event);\\\\n\\\\n				if (typeof window.activate_tooltip!='undefined')\\\\n				{\\\\n					var tag_text='';\\\\n					if (this.nodeName.toLowerCase()=='input')\\\\n					{\\\\n						tag_text=this.orig_title;\\\\n					} else\\\\n					{\\\\n						tag_text=get_inner_html(this);\\\\n					}\\\\n\\\\n					this.style.cursor='pointer';\\\\n\\\\n					var eventCopy={};\\\\n					if (event)\\\\n					{\\\\n						if (event.pageX) eventCopy.pageX=3000;\\\\n						if (event.clientX) eventCopy.clientX=3000;\\\\n						if (event.pageY) eventCopy.pageY=3000;\\\\n						if (event.clientY) eventCopy.clientY=3000;\\\\n\\\\n						var self_ob=this;\\\\n						if ((typeof this.rendered_tooltip=='undefined' && !self_ob.is_over) || (self_ob.tag_text!=tag_text))\\\\n						{\\\\n							self_ob.tag_text=tag_text;\\\\n							self_ob.is_over=true;\\\\n\\\\n							var url=maintain_theme_in_link('\\\",\\n	ecv_FIND_SCRIPT_NOHTTP(\\\$cl,array(2),array(\\\"comcode_convert\\\")),\\n	\\\"?css=1&javascript=1&box_title=\\\",\\n	ecv(\\\$cl,array(2,6),2,\\\"PREVIEW\\\",array()),\\n	\\\"'+keep_stub());\\\\n							if (window.location.href.indexOf('topics')!=-1) url+='&forum_db=1';\\\\n							var request=do_ajax_request(url,function(ajax_result_frame,ajax_result) {\\\\n								if (ajax_result)\\\\n								{\\\\n									var tmp_rendered=merge_text_nodes(ajax_result.childNodes);\\\\n									if (tmp_rendered.indexOf('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"CCP_ERROR_STUB\\\",array()),\\n	\\\"')==-1)\\\\n										self_ob.rendered_tooltip=tmp_rendered;\\\\n								}\\\\n								if (typeof self_ob.rendered_tooltip!='undefined')\\\\n								{\\\\n									if (self_ob.is_over)\\\\n									{\\\\n										activate_tooltip(self_ob,eventCopy,self_ob.rendered_tooltip,'auto',null,null,false,true);\\\\n										self_ob.title=self_ob.orig_title;\\\\n									}\\\\n								}\\\\n							},'data='+window.encodeURIComponent('[semihtml]'+tag_text.replace(/<\\\\\\\\/?span[^>]*>/gi,'')).substr(0,1000).replace(new RegExp(String.fromCharCode(8203),'g'),'')+'[/semihtml]');\\\\n						} else if (typeof this.rendered_tooltip!='undefined')\\\\n						{\\\\n							activate_tooltip(self_ob,eventCopy,self_ob.rendered_tooltip,'400px',null,null,false,true);\\\\n						}\\\\n					}\\\\n				}\\\\n			};\\\\n		}\\\\n	}\\\\n}\\\\n\\\\n// ============\\\\n// BOTH EDITORS\\\\n// ============\\\\n\\\\nfunction do_emoticon(field_name,p,_opener)\\\\n{\\\\n	var element;\\\\n	if (_opener)\\\\n	{\\\\n		element=get_main_cms_window().document.getElementById(field_name);\\\\n		if (!element) element=opener.document.getElementById(field_name); // If it is really actually cascading popups\\\\n	} else\\\\n	{\\\\n		element=document.getElementById(field_name);\\\\n	}\\\\n	element=ensure_true_id(element,field_name);\\\\n\\\\n	var title=p.title;\\\\n	if (title=='') title=p.getElementsByTagName('img')[0].alt; // Might be on image inside link instead\\\\n	title=title.replace(/^.*: /,'');\\\\n\\\\n	var text=' '+title+' ';\\\\n\\\\n	if (_opener)\\\\n	{\\\\n		insert_textbox_opener(element,text,null,true,get_inner_html(p));\\\\n	} else\\\\n	{\\\\n		insert_textbox(element,text,null,true,get_inner_html(p));\\\\n	}\\\\n}\\\\n\\\\nfunction do_attachment(field_name,id,description)\\\\n{\\\\n	if (!get_main_cms_window().wysiwyg_editors) return;\\\\n\\\\n	if (typeof description=='undefined') description='';\\\\n\\\\n	var element=get_main_cms_window().document.getElementById(field_name);\\\\n	element=ensure_true_id(element,field_name);\\\\n\\\\n	var comcode;\\\\n	comcode='\\\\\\\\n\\\\\\\\n[attachment description=\\\\\\\"'+escape_comcode(description)+'\\\\\\\"]'+id+'[/attachment]';\\\\n\\\\n	insert_textbox_opener(element,comcode);\\\\n}\\\\n\\\\nfunction ensure_true_id(element,field_name) // Works around IE bug\\\\n{\\\\n	var form=element.form;\\\\n	var i;\\\\n	for (i=0;i<form.elements.length;i++)\\\\n	{\\\\n		if ((form.elements[i].id==field_name)/* || (form.elements[i].name==field_name)*/)\\\\n		{\\\\n			return form.elements[i];\\\\n		}\\\\n	}\\\\n	return element;\\\\n}\\\\n\\\\nfunction is_wysiwyg_field(the_element)\\\\n{\\\\n	return ((typeof window.wysiwyg_editors!='undefined') && (typeof wysiwyg_editors[the_element.id]=='object'));\\\\n}\\\\n\\\\nfunction get_textbox(element)\\\\n{\\\\n	if (is_wysiwyg_field(element))\\\\n	{\\\\n		var ret=window.wysiwyg_editors[element.id].getData();\\\\n		if ((ret=='\\\\\\\\n') || (ret=='<br />')) ret='';\\\\n		return ret;\\\\n	}\\\\n	return element.value;\\\\n}\\\\n\\\\nfunction set_textbox(element,text,html)\\\\n{\\\\n	if (is_wysiwyg_field(element))\\\\n	{\\\\n		if (typeof html=='undefined') html=escape_html(text).replace(new RegExp('\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\n','gi'),'<br />');\\\\n\\\\n		window.wysiwyg_editors[element.id].setData(html);\\\\n\\\\n		window.wysiwyg_editors[element.id].updateElement();\\\\n\\\\n		window.setTimeout(function() {\\\\n			find_tags_in_editor(window.wysiwyg_editors[element.id],element);\\\\n		}, 100);\\\\n	} else\\\\n	{\\\\n		element.value=text;\\\\n	}\\\\n}\\\\n\\\\n/*\\\\nInsert some text, with WYSIWYG support...\\\\n\\\\nelement: non-WYSIWYG element\\\\ntext: text to insert (non-HTML)\\\\nsel: Selection DOM object so we know what to *overwrite* with the inserted text (or NULL)\\\\nplain_insert: Set to true if we are doing a simple insert, not inserting complex Comcode that needs to have editing representation\\\\nhtml: HTML to insert (if not passed then 'text' will be escaped)\\\\n\\\\n(Use insert_textbox_wrapping to wrap Comcode tags around a selection)\\\\n*/\\\\nfunction insert_textbox(element,text,sel,plain_insert,html)\\\\n{\\\\n	if (typeof plain_insert=='undefined') plain_insert=false;\\\\n	if (typeof html=='undefined') html=null;\\\\n\\\\n	if (is_wysiwyg_field(element))\\\\n	{\\\\n		var editor=window.wysiwyg_editors[element.id];\\\\n\\\\n		var insert='';\\\\n		if (plain_insert)\\\\n		{\\\\n			insert=get_selected_html(editor)+(html?html:escape_html(text).replace(new RegExp('\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\n','gi'),'<br />'));\\\\n		} else\\\\n		{\\\\n			var url=maintain_theme_in_link('\\\",\\n	ecv_FIND_SCRIPT_NOHTTP(\\\$cl,array(2),array(\\\"comcode_convert\\\")),\\n	\\\"?semihtml=1'+keep_stub());\\\\n			if (window.location.href.indexOf('topics')!=-1) url+='&forum_db=1';\\\\n			var request=do_ajax_request(url,null,'data='+window.encodeURIComponent(text.replace(new RegExp(String.fromCharCode(8203),'g'),'')));\\\\n			if ((request.responseXML) && (request.responseXML.documentElement.getElementsByTagName('result')[0]))\\\\n			{\\\\n				var result_tags=request.responseXML.documentElement.getElementsByTagName('result');\\\\n				var result=result_tags[0];\\\\n				insert=merge_text_nodes(result.childNodes).replace(/\\\\\\\\s*\\\\\\\$/,'');\\\\n			}\\\\n		}\\\\n\\\\n		var before=editor.getData();\\\\n\\\\n		try\\\\n		{\\\\n			editor.focus(); // Needed on some browsers\\\\n			var selected_html=get_selected_html(editor);\\\\n\\\\n			if ((editor.getSelection()) && (editor.getSelection().getStartElement().getName()=='kbd')) // Danger Danger - don't want to insert into another Comcode tag. Put it after. They can cut+paste back if they need.\\\\n			{\\\\n				editor.document.getBody().appendHtml(insert);\\\\n			} else\\\\n			{\\\\n				//editor.insertHtml(insert); Actually may break up the parent tag, we want it to nest nicely\\\\n				var element_for_inserting=window.CKEDITOR.dom.element.createFromHtml(insert);\\\\n				editor.insertElement(element_for_inserting);\\\\n			}\\\\n\\\\n			var after=editor.getData();\\\\n			if (after==before) throw 'Failed to insert';\\\\n\\\\n			find_tags_in_editor(editor,element);\\\\n		}\\\\n		catch (e) // Sometimes happens on Firefox in Windows, appending is a bit tamer (e.g. you cannot insert if you have the start of a h1 at cursor)\\\\n		{\\\\n			var after=editor.getData();\\\\n			if (after==before) // Could have just been a window.scrollBy popup-blocker exception, so only do this if the op definitely failed\\\\n				editor.document.getBody().appendHtml(insert);\\\\n		}\\\\n\\\\n		editor.updateElement();\\\\n\\\\n		return;\\\\n	}\\\\n\\\\n	var from=element.value.length,to;\\\\n\\\\n	element.focus();\\\\n\\\\n	if (typeof sel=='undefined') sel=null;\\\\n	if (sel===null) sel=document.selection?document.selection:null;\\\\n\\\\n	if (typeof element.selectionEnd!='undefined') // Mozilla style\\\\n	{\\\\n		from=element.selectionStart;\\\\n		to=element.selectionEnd;\\\\n\\\\n		var start=element.value.substring(0,from);\\\\n		var end=element.value.substring(to,element.value.length);\\\\n\\\\n		element.value=start+element.value.substring(from,to)+text+end;\\\\n		set_selection_range(element,from+text.length,from+text.length);\\\\n	} else\\\\n	if (sel) // IE style\\\\n	{\\\\n		var ourRange=sel.createRange();\\\\n		if ((ourRange.moveToElementText) || (ourRange.parentElement()==element))\\\\n		{\\\\n			if (ourRange.parentElement()!=element) ourRange.moveToElementText(element);\\\\n			ourRange.text=ourRange.text+text;\\\\n		} else\\\\n		{\\\\n			element.value+=text;\\\\n			from+=2;\\\\n			set_selection_range(element,from+text.length,from+text.length);\\\\n		}\\\\n	}\\\\n	else\\\\n	{\\\\n		// :(\\\\n		from+=2;\\\\n		element.value+=text;\\\\n		set_selection_range(element,from+text.length,from+text.length);\\\\n	}\\\\n}\\\\nfunction insert_textbox_opener(element,text,sel,plain_insert,html)\\\\n{\\\\n	if ((typeof sel=='undefined') || (!sel)) var sel=get_main_cms_window().document.selection?get_main_cms_window().document.selection:null;\\\\n\\\\n	get_main_cms_window().insert_textbox(element,text,sel,plain_insert,html);\\\\n}\\\\n\\\\n// Get selected HTML from CKEditor\\\\nfunction get_selected_html(editor)\\\\n{\\\\n	var my_selection=editor.getSelection();\\\\n	if (!my_selection || my_selection.getType()==window.CKEDITOR.SELECTION_NONE) return '';\\\\n\\\\n	var selected_text='';\\\\n	if (my_selection.getNative())\\\\n	{\\\\n		if ((window.CKEDITOR.env.ie) && (typeof my_selection.getNative().getRangeAt=='undefined')) // IE8 and under (selection object)\\\\n		{\\\\n			my_selection.unlock(true);\\\\n			selected_text=my_selection.getNative().createRange().htmlText;\\\\n		} else // IE9 / standards (HTMLSelection object)\\\\n		{\\\\n			try\\\\n			{\\\\n				selected_text=get_inner_html(my_selection.getNative().getRangeAt(0).cloneContents());\\\\n			}\\\\n			catch (e) {}\\\\n		}\\\\n	}\\\\n	return selected_text;\\\\n}\\\\n\\\\n// Insert into the editor such as to *wrap* the current selection with something new (typically a new Comcode tag)\\\\nfunction insert_textbox_wrapping(element,before_wrap_tag,after_wrap_tag)\\\\n{\\\\n	var from,to;\\\\n\\\\n	if (after_wrap_tag=='')\\\\n	{\\\\n		after_wrap_tag='[/'+before_wrap_tag+']';\\\\n		before_wrap_tag='['+before_wrap_tag+']';\\\\n	}\\\\n\\\\n	if (is_wysiwyg_field(element))\\\\n	{\\\\n		var editor=window.wysiwyg_editors[element.id];\\\\n\\\\n		editor.focus(); // Needed on some browsers, but on Opera will defocus our selection\\\\n		var selected_html=get_selected_html(editor);\\\\n\\\\n		if (selected_html=='') selected_html='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:TEXT_OR_COMCODE_GOES_HERE\\\",array()),\\n	\\\"'.toUpperCase();\\\\n\\\\n		var new_html='';\\\\n\\\\n		var url=maintain_theme_in_link('\\\",\\n	ecv_FIND_SCRIPT_NOHTTP(\\\$cl,array(2),array(\\\"comcode_convert\\\")),\\n	\\\"?semihtml=1'+keep_stub());\\\\n		if (window.location.href.indexOf('topics')!=-1) url+='&forum_db=1';\\\\n		var request=do_ajax_request(url,null,'data='+window.encodeURIComponent((before_wrap_tag+selected_html+after_wrap_tag).replace(new RegExp(String.fromCharCode(8203),'g'),'')));\\\\n		if ((request.responseXML) && (request.responseXML.documentElement.getElementsByTagName('result')[0]))\\\\n		{\\\\n			var result_tags=request.responseXML.documentElement.getElementsByTagName('result');\\\\n			var result=result_tags[0];\\\\n			new_html=merge_text_nodes(result.childNodes).replace(/\\\\\\\\s*\\\\\\\$/,''); /* result is an XML-escaped string of HTML, so we get via looking at the node text */\\\\n		} else\\\\n		{\\\\n			new_html=selected_html;\\\\n		}\\\\n\\\\n		if ((editor.getSelection()) && (editor.getSelection().getStartElement().getName()=='kbd')) // Danger Danger - don't want to insert into another Comcode tag. Put it after. They can cut+paste back if they need.\\\\n		{\\\\n			editor.document.getBody().appendHtml(new_html);\\\\n		} else\\\\n		{\\\\n			editor.insertHtml(new_html);\\\\n		}\\\\n\\\\n		editor.updateElement();\\\\n\\\\n		find_tags_in_editor(editor,element);\\\\n\\\\n		return;\\\\n	}\\\\n\\\\n	if (typeof element.selectionEnd!='undefined') // Mozilla style\\\\n	{\\\\n		from=element.selectionStart;\\\\n		to=element.selectionEnd;\\\\n\\\\n		var start=element.value.substring(0,from);\\\\n		var end=element.value.substring(to,element.value.length);\\\\n\\\\n		if (to>from)\\\\n		{\\\\n			element.value=start+before_wrap_tag+element.value.substring(from,to)+after_wrap_tag+end;\\\\n		} else\\\\n		{\\\\n			element.value=start+before_wrap_tag+after_wrap_tag+end;\\\\n		}\\\\n		set_selection_range(element,from,to+before_wrap_tag.length+after_wrap_tag.length);\\\\n	} else\\\\n	if (typeof document.selection!='undefined') // IE style\\\\n	{\\\\n		element.focus();\\\\n		var sel=document.selection;\\\\n		var ourRange=sel.createRange();\\\\n		if ((ourRange.moveToElementText) || (ourRange.parentElement()==element))\\\\n		{\\\\n			if (ourRange.parentElement()!=element) ourRange.moveToElementText(element);\\\\n			ourRange.text=before_wrap_tag+ourRange.text+after_wrap_tag;\\\\n		} else element.value+=before_wrap_tag+after_wrap_tag;\\\\n	}\\\\n	else\\\\n	{\\\\n		// :(\\\\n		element.value+=before_wrap_tag+after_wrap_tag;\\\\n		set_selection_range(element,from,to+before_wrap_tag.length+after_wrap_tag.length);\\\\n	}\\\\n}\\\\n\\\\n// From http://www.faqts.com/knowledge_base/view.phtml/aid/13562\\\\nfunction set_selection_range(input,selection_start,selection_end)\\\\n{\\\\n	if (typeof input.set_selection_range!='undefined') /* Mozilla style */\\\\n	{\\\\n		input.focus();\\\\n		input.set_selection_range(selection_start,selection_end);\\\\n	}\\\\n	else if (typeof input.createTextRange!='undefined') /* IE style */\\\\n	{\\\\n		var range=input.createTextRange();\\\\n		range.collapse(true);\\\\n		range.moveEnd('character',selection_end);\\\\n		range.moveStart('character',selection_start);\\\\n		range.select();\\\\n	} else input.focus();\\\\n}\\\\n\\\\nfunction show_upload_syndication_options(name,syndication_json,no_quota)\\\\n{\\\\n	if (typeof no_quota=='undefined') no_quota=false;\\\\n\\\\n	var html_spot=document.getElementById(name+'_syndication_options');\\\\n	var html='';\\\\n	var num_checked=0;\\\\n	var file_ob=document.getElementById(name);\\\\n	var pre_disabled=file_ob.disabled;\\\\n\\\\n	var syndication=JSON.parse(syndication_json),id,authorised,label,checked;\\\\n	var num=0;\\\\n	for (var hook in syndication)\\\\n	{\\\\n		num++;\\\\n	}\\\\n	for (var hook in syndication)\\\\n	{\\\\n		id='upload_syndicate__'+hook+'__'+name;\\\\n		authorised=syndication[hook].authorised;\\\\n		label=syndication[hook].label;\\\\n\\\\n		if (authorised)\\\\n		{\\\\n			checked=true;\\\\n			num_checked++;\\\\n		} else\\\\n		{\\\\n			checked=false;\\\\n		}\\\\n\\\\n		window.setTimeout(function(id,authorised) {\\\\n			return function() {\\\\n				document.getElementById(id).onclick=function() {\\\\n					var e=document.getElementById(id);\\\\n					if (e.checked)\\\\n					{\\\\n						if (!authorised)\\\\n						{\\\\n							//e.checked=false;	Better to assume success, not all oAuth support callback\\\\n							var url='\\\",\\n	ecv_FIND_SCRIPT(\\\$cl,array(2),array(\\\"upload_syndication_auth\\\")),\\n	\\\"?hook='+window.encodeURIComponent(hook)+'&name='+window.encodeURIComponent(name)+keep_stub();\\\\n							\\\",\\n	((ecv_MOBILE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n								window.open(url);\\\\n							\\\"):''),\\n	\\\"\\\\n							\\\",\\n	((ecv_NOT(\\\$cl,array(),array(ecv_MOBILE(\\\$cl,array(),array())))==\\\"1\\\")?(\\\"\\\\n								faux_open(url,null,'width=960;height=500','_top');\\\\n							\\\"):''),\\n	\\\"\\\\n							if (!pre_disabled)\\\\n							{\\\\n								file_ob.disabled=false;\\\\n							}\\\\n						}\\\\n					}\\\\n				};\\\\n			};\\\\n		}(id,authorised),0);\\\\n\\\\n		html+='<span><label for=\\\\\\\"'+id+'\\\\\\\"><input type=\\\\\\\"checkbox\\\\\\\" '+(checked?'checked=\\\\\\\"checked\\\\\\\" ':'')+'id=\\\\\\\"'+id+'\\\\\\\" name=\\\\\\\"'+id+'\\\\\\\" value=\\\\\\\"1\\\\\\\" />Upload to '+escape_html(label)+(((no_quota) && (num==1))?' (\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"_REQUIRED\\\",array()),\\n	\\\")':'')+'</label></span>';\\\\n	}\\\\n\\\\n	if ((no_quota) && (num_checked==0))\\\\n	{\\\\n		file_ob.disabled=true;\\\\n	}\\\\n\\\\n	if ((html!='') && (!no_quota))\\\\n	{\\\\n		html+='<span><label for=\\\\\\\"force_remove_locally\\\\\\\"><input type=\\\\\\\"checkbox\\\\\\\" id=\\\\\\\"force_remove_locally\\\\\\\" name=\\\\\\\"force_remove_locally\\\\\\\" value=\\\\\\\"1\\\\\\\" />Reference remotely (delete locally)</label></span>';\\\\n	}\\\\n\\\\n	html='<div>'+html+'</div>';\\\\n\\\\n	set_inner_html(html_spot,html);\\\\n}\\\\n\\\\nfunction clear_attachment(i,post_field)\\\\n{\\\\n	var new_contents=get_textbox(post_field);\\\\n	new_contents=new_contents.replace(new RegExp('\\\\\\\\\\\\\\\\[(attachment|attachment_safe)[^\\\\\\\\\\\\\\\\]]*\\\\\\\\\\\\\\\\]new_'+i+'\\\\\\\\\\\\\\\\[/(attachment|attachment_safe)\\\\\\\\\\\\\\\\]'),'');\\\\n	new_contents=new_contents.replace(new RegExp('<input[^<>]* class=\\\\\\\"cms_keep_ui_controlled\\\\\\\"[^<>]* title=\\\\\\\"[^<>]*\\\\\\\" value=\\\\\\\"[^\\\\\\\"]+\\\\\\\"[^<>]* />'),''); // Shell of the above\\\\n	set_textbox(post_field,new_contents,new_contents);\\\\n	document.getElementById('file'+i).value='';\\\\n	return false;\\\\n}\\\\n\\\";\");\";}}");

