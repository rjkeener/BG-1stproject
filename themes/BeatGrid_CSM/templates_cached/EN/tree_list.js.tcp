<?php
return unserialize("a:5:{i:0;a:1:{i:0;a:1:{i:0;a:5:{i:0;s:33:\"tcpfunc_5abfd0efafba08.80379553_1\";i:1;a:0:{}i:2;i:1;i:3;s:0:\"\";i:4;s:0:\"\";}}}i:1;a:0:{}i:2;s:9:\"tree_list\";i:3;N;i:4;a:1:{s:33:\"tcpfunc_5abfd0efafba08.80379553_1\";s:32383:\"\$tpl_funcs['tcpfunc_5abfd0efafba08.80379553_1']=\$KEEP_TPL_FUNCS['tcpfunc_5abfd0efafba08.80379553_1']=recall_named_function('5abfd0efafbcd8.03523319','\$parameters,\$cl',\"echo \\\"\\\\\\\"use strict\\\\\\\";\\\\n\\\\nwindow.tree_list=function(name,hook,root_id,options,multi_selection,tabindex,all_nodes_selectable,use_server_id)\\\\n{\\\\n	if (typeof window.do_ajax_request=='undefined') return;\\\\n	if (typeof use_server_id=='undefined') use_server_id=false;\\\\n\\\\n	if ((typeof multi_selection=='undefined') || (!multi_selection)) var multi_selection=false;\\\\n\\\\n	this.name=name;\\\\n	this.hook=hook;\\\\n	this.options=options;\\\\n	this.multi_selection=multi_selection;\\\\n	this.tabindex=tabindex?tabindex:null;\\\\n	this.all_nodes_selectable=all_nodes_selectable;\\\\n	this.use_server_id=use_server_id;\\\\n\\\\n	var element=document.getElementById('tree_list__root_'+name);\\\\n	set_inner_html(element,'<div class=\\\\\\\"ajax_loading vertical_alignment\\\\\\\"><img src=\\\\\\\"'+'\\\",\\n	ecv_IMG(\\\$cl,array(1,2),array(\\\"loading\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"'.replace(/^https?:/,window.location.protocol)+'\\\\\\\" alt=\\\\\\\"\\\\\\\" /> <span>\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"LOADING\\\",array()),\\n	\\\"</span></div>');\\\\n\\\\n	// Initial rendering\\\\n	var url='/'+hook;\\\\n	if (root_id!==null) url+='&id='+window.encodeURIComponent(root_id);\\\\n	url+='&options='+options;\\\\n	url+='&default='+window.encodeURIComponent(document.getElementById(name).value);\\\\n	do_ajax_request(url,this);\\\\n\\\\n	register_mouse_listener();\\\\n};\\\\n\\\\ntree_list.prototype.tree_list_data='';\\\\ntree_list.prototype.busy=false;\\\\ntree_list.prototype.last_clicked=null; // The hyperlink object that was last clicked (usage during multi selection when holding down shift)\\\\n\\\\n/* Go through our tree list looking for a particular XML node */\\\\ntree_list.prototype.getElementByIdHack=function(id,type,ob,serverid)\\\\n{\\\\n	if ((typeof type=='undefined') || (!type)) var type='c';\\\\n	if ((typeof ob=='undefined') || (!ob)) var ob=this.tree_list_data;\\\\n	var i,test,done=false;\\\\n	// Normally we could only ever use getElementsByTagName, but Konqueror and Safari don't like it\\\\n	try // IE9 beta has serious problems\\\\n	{\\\\n		if ((typeof ob.getElementsByTagName!='undefined') && (typeof ob.getElementsByTagName!='unknown'))\\\\n		{\\\\n			var results=ob.getElementsByTagName((type=='c')?'category':'entry');\\\\n			for (i=0;i<results.length;i++)\\\\n			{\\\\n				if ((typeof results[i].getAttribute!='undefined') && (typeof results[i].getAttribute!='unknown') && (results[i].getAttribute(serverid?'serverid':'id')==id))\\\\n				{\\\\n					return results[i];\\\\n				}\\\\n			}\\\\n			done=true;\\\\n		}\\\\n	}\\\\n	catch (e) {}\\\\n	if (!done)\\\\n	{\\\\n		for (i=0;i<ob.childNodes.length;i++)\\\\n		{\\\\n			if (ob.childNodes[i].nodeName.toLowerCase()=='category')\\\\n			{\\\\n				test=this.getElementByIdHack(id,type,ob.childNodes[i],serverid);\\\\n				if (test)\\\\n				{\\\\n					return test;\\\\n				}\\\\n			}\\\\n			if ((ob.childNodes[i].nodeName.toLowerCase()==((type=='c')?'category':'entry')) && (ob.childNodes[i].getAttribute(serverid?'serverid':'id')==id))\\\\n				return ob.childNodes[i];\\\\n		}\\\\n	}\\\\n	return null;\\\\n};\\\\n\\\\ntree_list.prototype.response=function(ajax_result_frame,ajax_result,expanding_id)\\\\n{\\\\n	if (!window.fixup_node_positions) return;\\\\n\\\\n	ajax_result=careful_import_node(ajax_result);\\\\n\\\\n	var i,xml,temp_node,html;\\\\n	if (!expanding_id) // Root\\\\n	{\\\\n		html=document.getElementById('tree_list__root_'+this.name);\\\\n		set_inner_html(html,'');\\\\n\\\\n		this.tree_list_data=ajax_result.cloneNode(true);\\\\n		xml=this.tree_list_data;\\\\n\\\\n		if (!has_child_nodes(xml))\\\\n		{\\\\n			var error=document.createTextNode((this.name.indexOf('category')==-1 && window.location.href.indexOf('category')==-1)?'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"NO_ENTRIES\\\",array()),\\n	\\\"':'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"NO_CATEGORIES\\\",array()),\\n	\\\"');\\\\n			html.className='red_alert';\\\\n			html.appendChild(error);\\\\n			return;\\\\n		}\\\\n	} else // Appending\\\\n	{\\\\n		xml=this.getElementByIdHack(expanding_id,'c');\\\\n		for (i=0;i<ajax_result.childNodes.length;i++)\\\\n		{\\\\n			temp_node=ajax_result.childNodes[i];\\\\n			xml.appendChild(temp_node.cloneNode(true));\\\\n		}\\\\n		html=document.getElementById(this.name+'tree_list_c_'+expanding_id);\\\\n	}\\\\n\\\\n	attributes_full_fixup(xml);\\\\n\\\\n	this.root_element=this.render_tree(xml,html);\\\\n\\\\n	var name=this.name;\\\\n	fixup_node_positions(name);\\\\n	//window.setTimeout(function() { fixup_node_positions(name); },500);\\\\n};\\\\n\\\\nfunction attributes_full_fixup(xml)\\\\n{\\\\n	var node,i;\\\\n	if (typeof window.attributes_full=='undefined') window.attributes_full={};\\\\n	var id=xml.getAttribute('id');\\\\n	if (typeof window.attributes_full[id]=='undefined') window.attributes_full[id]={};\\\\n	for (i=0;i<xml.attributes.length;i++)\\\\n	{\\\\n		window.attributes_full[id][xml.attributes[i].name]=xml.attributes[i].value;\\\\n	}\\\\n	for (i=0;i<xml.childNodes.length;i++)\\\\n	{\\\\n		node=xml.childNodes[i];\\\\n\\\\n		if (node.nodeName=='#text') continue; // A text-node\\\\n\\\\n		if ((node.nodeName.toLowerCase()=='category') || (node.nodeName.toLowerCase()=='entry'))\\\\n		{\\\\n			attributes_full_fixup(node);\\\\n		}\\\\n	}\\\\n}\\\\n\\\\nfunction has_child_nodes(node)\\\\n{\\\\n	for (var i=0;i<node.childNodes.length;i++)\\\\n	{\\\\n		if (node.childNodes[i].nodeName!='#text') return true;\\\\n	}\\\\n	return false;\\\\n}\\\\n\\\\ntree_list.prototype.render_tree=function(xml,html,element)\\\\n{\\\\n	if (!window.fixup_node_positions) return null;\\\\n\\\\n	var i,colour,new_html,url,escaped_title;\\\\n	var initially_expanded,selectable,extra,url,title,func,temp,master_html,node,node_self_wrap,node_self;\\\\n	if ((typeof element=='undefined') || (!element)) var element=document.getElementById(this.name);\\\\n\\\\n	if (typeof window.fade_transition!='undefined')\\\\n	{\\\\n		set_opacity(html,0.0);\\\\n		fade_transition(html,100,30,4);\\\\n	}\\\\n\\\\n	html.style.display='block';\\\\n	if (!has_child_nodes(xml))\\\\n	{\\\\n		html.style.display='none';\\\\n	}\\\\n\\\\n	for (i=0;i<xml.childNodes.length;i++)\\\\n	{\\\\n		node=xml.childNodes[i];\\\\n		if (node.nodeName=='#text') continue; // A text-node\\\\n\\\\n		// Special handling of 'options' nodes, inject new options\\\\n		if (node.nodeName=='options')\\\\n		{\\\\n			this.options=window.encodeURIComponent(get_inner_html(node));\\\\n			continue;\\\\n		}\\\\n\\\\n		// Special handling of 'expand' nodes, which say to pre-expand some categories as soon as the page loads\\\\n		if (node.nodeName=='expand')\\\\n		{\\\\n			var e=document.getElementById(this.name+'texp_c_'+get_inner_html(node));\\\\n			if (e)\\\\n			{\\\\n				var html_node=document.getElementById(this.name+'tree_list_c_'+get_inner_html(node));\\\\n				var expanding=(html_node.style.display!='block');\\\\n				if (expanding)\\\\n					e.onclick(null,true);\\\\n			} else\\\\n			{\\\\n				// Now try against serverid\\\\n				var xml_node=this.getElementByIdHack(get_inner_html(node),'c',null,true);\\\\n				if (xml_node)\\\\n				{\\\\n					var e=document.getElementById(this.name+'texp_c_'+xml_node.getAttribute('id'));\\\\n					if (e)\\\\n					{\\\\n						var html_node=document.getElementById(this.name+'tree_list_c_'+xml_node.getAttribute('id'));\\\\n						var expanding=(html_node.style.display!='block');\\\\n						if (expanding)\\\\n							e.onclick(null,true);\\\\n					}\\\\n				}\\\\n			}\\\\n			continue;\\\\n		}\\\\n\\\\n		// Category or entry nodes\\\\n		extra=' ';\\\\n		func=node.getAttribute('img_func_1');\\\\n		if (func)\\\\n		{\\\\n			extra=extra+eval(func+'(node)');\\\\n		}\\\\n		func=node.getAttribute('img_func_2');\\\\n		if (func)\\\\n		{\\\\n			extra=extra+eval(func+'(node)');\\\\n		}\\\\n		node_self_wrap=document.createElement('div');\\\\n		node_self=document.createElement('div');\\\\n		node_self.style.display='inline-block';\\\\n		node_self_wrap.appendChild(node_self);\\\\n		node_self.object=this;\\\\n		colour=(node.getAttribute('selectable')=='true' || this.all_nodes_selectable)?'native_ui_foreground':'locked_input_field';\\\\n		selectable=(node.getAttribute('selectable')=='true' || this.all_nodes_selectable);\\\\n		if (node.nodeName.toLowerCase()=='category')\\\\n		{\\\\n			// Render self\\\\n			node_self.className=(node.getAttribute('highlighted')=='true')?'tree_list_highlighted':'tree_list_nonhighlighted';\\\\n			initially_expanded=(node.getAttribute('has_children')!='true') || (node.getAttribute('expanded')=='true');\\\\n			escaped_title=escape_html((typeof node.getAttribute('title')!='undefined')?node.getAttribute('title'):'');\\\\n			if (escaped_title=='') escaped_title='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"NA_EM\\\",array()),\\n	\\\"';\\\\n			var description='';\\\\n			var description_in_use='';\\\\n			if (node.getAttribute('description_html'))\\\\n			{\\\\n				description=node.getAttribute('description_html');\\\\n				description_in_use=escape_html(description);\\\\n			} else\\\\n			{\\\\n				if (node.getAttribute('description')) description=escape_html('. '+node.getAttribute('description'));\\\\n				description_in_use=escaped_title+': \\\",\\n	ecv(\\\$cl,array(1,2,8),2,\\\"TREE_LIST_SELECT\\\",array()),\\n	\\\"'+description+((node.getAttribute('serverid')=='')?(' ('+escape_html(node.getAttribute('serverid'))+')'):'');\\\\n			}\\\\n			set_inner_html(node_self,'<div><input class=\\\\\\\"ajax_tree_expand_icon\\\\\\\"'+(this.tabindex?(' tabindex=\\\\\\\"'+this.tabindex+'\\\\\\\"'):'')+' type=\\\\\\\"image\\\\\\\" alt=\\\\\\\"'+((!initially_expanded)?'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"EXPAND\\\",array()),\\n	\\\"':'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"CONTRACT\\\",array()),\\n	\\\"')+': '+escaped_title+'\\\\\\\" title=\\\\\\\"'+((!initially_expanded)?'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"EXPAND\\\",array()),\\n	\\\"':'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"CONTRACT\\\",array()),\\n	\\\"')+'\\\\\\\" id=\\\\\\\"'+this.name+'texp_c_'+node.getAttribute('id')+'\\\\\\\" src=\\\\\\\"'+((!initially_expanded)?'\\\",\\n	ecv_IMG(\\\$cl,array(1,2),array(\\\"1x/treefield/expand\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"':'\\\",\\n	ecv_IMG(\\\$cl,array(1,2),array(\\\"1x/treefield/collapse\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"').replace(/^https?:/,window.location.protocol)+'\\\\\\\" srcset=\\\\\\\"'+((!initially_expanded)?'\\\",\\n	ecv_IMG(\\\$cl,array(1,2),array(\\\"2x/treefield/expand\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"':'\\\",\\n	ecv_IMG(\\\$cl,array(1,2),array(\\\"2x/treefield/collapse\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"').replace(/^https?:/,window.location.protocol)+' 2x\\\\\\\" /> <img class=\\\\\\\"ajax_tree_cat_icon\\\\\\\" alt=\\\\\\\"\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"CATEGORY\\\",array()),\\n	\\\"\\\\\\\" src=\\\\\\\"'+'\\\",\\n	ecv_IMG(\\\$cl,array(1,2),array(\\\"1x/treefield/category\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"'.replace(/^https?:/,window.location.protocol)+'\\\\\\\" srcset=\\\\\\\"'+'\\\",\\n	ecv_IMG(\\\$cl,array(1,2),array(\\\"2x/treefield/category\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\" 2x'.replace(/^https?:/,window.location.protocol)+'\\\\\\\" /> <label id=\\\\\\\"'+this.name+'tsel_c_'+node.getAttribute('id')+'\\\\\\\" for=\\\\\\\"'+this.name+'tsel_r_'+node.getAttribute('id')+'\\\\\\\" onmouseout=\\\\\\\"if (typeof window.deactivate_tooltip!=\\\\\\\\'undefined\\\\\\\\') deactivate_tooltip(this);\\\\\\\" onmousemove=\\\\\\\"if (typeof window.activate_tooltip!=\\\\\\\\'undefined\\\\\\\\') reposition_tooltip(this,event);\\\\\\\" onmouseover=\\\\\\\"if (typeof window.activate_tooltip!=\\\\\\\\'undefined\\\\\\\\') activate_tooltip(this,event,'+(node.getAttribute('description_html')?'':'escape_html')+'(this.childNodes[0].title),\\\\\\\\'auto\\\\\\\\');\\\\\\\" class=\\\\\\\"ajax_tree_magic_button '+colour+'\\\\\\\"><input '+(this.tabindex?('tabindex=\\\\\\\"'+this.tabindex+'\\\\\\\" '):'')+'id=\\\\\\\"'+this.name+'tsel_r_'+node.getAttribute('id')+'\\\\\\\" style=\\\\\\\"position: absolute; left: -10000px\\\\\\\" type=\\\\\\\"radio\\\\\\\" name=\\\\\\\"_'+this.name+'\\\\\\\" value=\\\\\\\"1\\\\\\\" title=\\\\\\\"'+description_in_use+'\\\\\\\" />'+escaped_title+'</label> <span id=\\\\\\\"'+this.name+'extra_'+node.getAttribute('id')+'\\\\\\\">'+extra+'</span></div>');\\\\n			var expand_button=node_self.getElementsByTagName('input')[0];\\\\n			var _this=this;\\\\n			expand_button.oncontextmenu=function() { return false; };\\\\n			expand_button.object=this;\\\\n			expand_button.onclick=function(expand_button) { return function(event,automated) {\\\\n				if (document.getElementById('choose_'+_this.name)) click_link(document.getElementById('choose_'+_this.name));\\\\n				if (!event) var event=window.event;\\\\n				if (event)\\\\n				{\\\\n					event.returnValue=false;\\\\n					if (typeof event.preventDefault!='undefined') event.preventDefault();\\\\n				}\\\\n				_this.handle_tree_click.call(expand_button,event,automated);\\\\n				return false;\\\\n			}}(expand_button);\\\\n			var a=node_self.getElementsByTagName('label')[0];\\\\n			expand_button.onkeypress=a.onkeypress=a.childNodes[0].onkeypress=function(expand_button) {\\\\n				return function(event) {\\\\n					if (typeof event=='undefined') event=window.event;\\\\n					if (((event.keyCode?event.keyCode:event.charCode)==13) || ['+','-','='].indexOf(String.fromCharCode(event.keyCode?event.keyCode:event.charCode))!=-1)\\\\n						expand_button.onclick(event);\\\\n				}\\\\n			} (expand_button);\\\\n			a.oncontextmenu=function() { return false; };\\\\n			a.handle_selection=this.handle_selection;\\\\n			a.childNodes[0].onfocus=function() { this.parentNode.style.outline='1px dotted'; };\\\\n			a.childNodes[0].onblur=function() { this.parentNode.style.outline=''; };\\\\n			a.childNodes[0].onclick=a.handle_selection;\\\\n			a.onclick=a.handle_selection; // Needed by Firefox, the radio button's onclick will not be called if shift/ctrl held\\\\n			a.childNodes[0].object=this;\\\\n			a.object=this;\\\\n			a.onmousedown=function(event) { // To disable selection of text when holding shift or control\\\\n				if (event.ctrlKey || event.metaKey || event.shiftKey)\\\\n				{\\\\n					if (typeof event=='undefined') event=window.event;\\\\n					if (typeof event.preventDefault!='undefined') event.preventDefault();\\\\n				}\\\\n			};\\\\n			html.appendChild(node_self_wrap);\\\\n\\\\n			// Do any children\\\\n			new_html=document.createElement('div');\\\\n			new_html.role='treeitem';\\\\n			new_html.id=this.name+'tree_list_c_'+node.getAttribute('id');\\\\n			new_html.style.display=((!initially_expanded) || (node.getAttribute('has_children')!='true'))?'none':'block';\\\\n			new_html.style.padding\\\",\\n	((((((\\\"left\\\")==(\\\"left\\\"))?\\\"1\\\":\\\"0\\\"))==\\\"1\\\")?(\\\"Left\\\"):(\\\"Right\\\")),\\n	\\\"='15px';\\\\n			var selected=((this.use_server_id?node.getAttribute('serverid'):node.getAttribute('id'))==element.value && element.value!='') || node.getAttribute('selected')=='yes';\\\\n			if (selectable)\\\\n			{\\\\n				this.make_element_look_selected(document.getElementById(this.name+'tsel_c_'+node.getAttribute('id')),selected);\\\\n				if (selected)\\\\n				{\\\\n					element.value=(this.use_server_id?node.getAttribute('serverid'):node.getAttribute('id')); // Copy in proper ID for what is selected, not relying on what we currently have as accurate\\\\n					if (element.value!='')\\\\n					{\\\\n						if (typeof element.selected_title=='undefined') element.selected_title='';\\\\n						if (element.selected_title!='') element.selected_title+=',';\\\\n						element.selected_title+=node.getAttribute('title');\\\\n					}\\\\n					if (element.onchange) element.onchange();\\\\n					if (typeof element.fakeonchange!='undefined' && element.fakeonchange) element.fakeonchange();\\\\n				}\\\\n			}\\\\n			node_self.appendChild(new_html);\\\\n\\\\n			// Auto-expand\\\\n			if (window.ctrl_pressed || window.alt_pressed || window.meta_pressed || window.shift_pressed)\\\\n			{\\\\n				if (!initially_expanded)\\\\n					expand_button.onclick();\\\\n			}\\\\n		} else // Assume entry\\\\n		{\\\\n			new_html=null;\\\\n\\\\n			escaped_title=escape_html((typeof node.getAttribute('title')!='undefined')?node.getAttribute('title'):'');\\\\n			if (escaped_title=='') escaped_title='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"NA_EM\\\",array()),\\n	\\\"';\\\\n\\\\n			var description='';\\\\n			var description_in_use='';\\\\n			if (node.getAttribute('description_html'))\\\\n			{\\\\n				description=node.getAttribute('description_html');\\\\n				description_in_use=escape_html(description);\\\\n			} else\\\\n			{\\\\n				if (node.getAttribute('description')) description=escape_html('. '+node.getAttribute('description'));\\\\n				description_in_use=escaped_title+': \\\",\\n	ecv(\\\$cl,array(1,2,8),2,\\\"TREE_LIST_SELECT\\\",array()),\\n	\\\"'+description+((node.getAttribute('serverid')=='')?(' ('+escape_html(node.getAttribute('serverid'))+')'):'');\\\\n			}\\\\n\\\\n			// Render self\\\\n			initially_expanded=false;\\\\n			set_inner_html(node_self,'<div><img alt=\\\\\\\"\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"ENTRY\\\",array()),\\n	\\\"\\\\\\\" src=\\\\\\\"'+'\\\",\\n	ecv_IMG(\\\$cl,array(1,2),array(\\\"1x/treefield/entry\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"'.replace(/^https?:/,window.location.protocol)+'\\\\\\\" srcset=\\\\\\\"'+'\\\",\\n	ecv_IMG(\\\$cl,array(1,2),array(\\\"2x/treefield/entry\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\" 2x'.replace(/^https?:/,window.location.protocol)+'\\\\\\\" style=\\\\\\\"width: 14px; height: 14px; padding-left: 16px\\\\\\\" /> <label id=\\\\\\\"'+this.name+'tsel_e_'+node.getAttribute('id')+'\\\\\\\" class=\\\\\\\"ajax_tree_magic_button '+colour+'\\\\\\\" for=\\\\\\\"'+this.name+'tsel_s_'+node.getAttribute('id')+'\\\\\\\" onmouseout=\\\\\\\"if (typeof window.deactivate_tooltip!=\\\\\\\\'undefined\\\\\\\\') deactivate_tooltip(this);\\\\\\\" onmousemove=\\\\\\\"if (typeof window.activate_tooltip!=\\\\\\\\'undefined\\\\\\\\') reposition_tooltip(this,event);\\\\\\\" onmouseover=\\\\\\\"if (typeof window.activate_tooltip!=\\\\\\\\'undefined\\\\\\\\') activate_tooltip(this,event,'+(node.getAttribute('description_html')?'':'escape_html')+'(\\\\\\\\''+(description_in_use.replace(/\\\\\\\\n/g,'').replace(/'/g,'\\\\\\\\\\\\\\\\'+'\\\\\\\\''))+'\\\\\\\\'),\\\\\\\\'800px\\\\\\\\');\\\\\\\"><input'+(this.tabindex?(' tabindex=\\\\\\\"'+this.tabindex+'\\\\\\\"'):'')+' id=\\\\\\\"'+this.name+'tsel_s_'+node.getAttribute('id')+'\\\\\\\" style=\\\\\\\"position: absolute; left: -10000px\\\\\\\" type=\\\\\\\"radio\\\\\\\" name=\\\\\\\"_'+this.name+'\\\\\\\" value=\\\\\\\"1\\\\\\\" />'+escaped_title+'</label>'+extra+'</div>');\\\\n			var a=node_self.getElementsByTagName('label')[0];\\\\n			a.handle_selection=this.handle_selection;\\\\n			a.childNodes[0].onfocus=function() { this.parentNode.style.outline='1px dotted'; };\\\\n			a.childNodes[0].onblur=function() { this.parentNode.style.outline=''; };\\\\n			a.childNodes[0].onclick=a.handle_selection;\\\\n			a.onclick=a.handle_selection; // Needed by Firefox, the radio button's onclick will not be called if shift/ctrl held\\\\n			a.childNodes[0].object=this;\\\\n			a.object=this;\\\\n			a.onmousedown=function(event) { // To disable selection of text when holding shift or control\\\\n				if (event.ctrlKey || event.metaKey || event.shiftKey)\\\\n				{\\\\n					if (typeof event=='undefined') event=window.event;\\\\n					if (typeof event.preventDefault!='undefined') event.preventDefault();\\\\n				}\\\\n			};\\\\n			html.appendChild(node_self_wrap);\\\\n			var selected=((this.use_server_id?node.getAttribute('serverid'):node.getAttribute('id'))==element.value) || node.getAttribute('selected')=='yes';\\\\n			if ((this.multi_selection) && (!selected))\\\\n			{\\\\n				selected=((','+element.value+',').indexOf(','+node.getAttribute('id')+',')!=-1);\\\\n			}\\\\n			this.make_element_look_selected(document.getElementById(this.name+'tsel_e_'+node.getAttribute('id')),selected);\\\\n		}\\\\n\\\\n		if ((node.getAttribute('draggable')) && (node.getAttribute('draggable')!='false'))\\\\n		{\\\\n			master_html=document.getElementById('tree_list__root_'+this.name);\\\\n			fix_up_node_position(node_self);\\\\n			node_self.cms_draggable=node.getAttribute('draggable');\\\\n			node_self.draggable=true;\\\\n			node_self.ondragstart=function(event) {\\\\n				clear_out_tooltips();\\\\n\\\\n				this.className+=' being_dragged';\\\\n\\\\n				window.is_doing_a_drag=true;\\\\n			};\\\\n			node_self.ondrag=function(event) {\\\\n				if (!event.clientY) return;\\\\n				var hit=find_overlapping_selectable(event.clientY+get_window_scroll_y(),this,this.object.tree_list_data,this.object.name);\\\\n				if (this.last_hit!=null)\\\\n				{\\\\n					this.last_hit.parentNode.parentNode.style.border='0px';\\\\n				}\\\\n				if (hit!=null)\\\\n				{\\\\n					hit.parentNode.parentNode.style.border='1px dotted green';\\\\n					this.last_hit=hit;\\\\n				}\\\\n			};\\\\n			node_self.ondragend=function(event) {\\\\n				window.is_doing_a_drag=false;\\\\n\\\\n				this.className=this.className.replace(/ being_dragged/g,'');\\\\n\\\\n				if (this.last_hit!=null)\\\\n				{\\\\n					this.last_hit.parentNode.parentNode.style.border='0px';\\\\n\\\\n					if (this.parentNode.parentNode!=this.last_hit)\\\\n					{\\\\n						var xml_node=this.object.getElementByIdHack(this.getElementsByTagName('input')[0].id.substr(7+this.object.name.length));\\\\n						var target_xml_node=this.object.getElementByIdHack(this.last_hit.id.substr(12+this.object.name.length));\\\\n\\\\n						if ((this.last_hit.childNodes.length==1) && (this.last_hit.childNodes[0].nodeName=='#text'))\\\\n						{\\\\n							set_inner_html(this.last_hit,'');\\\\n							this.object.render_tree(target_xml_node,this.last_hit);\\\\n						}\\\\n\\\\n						// Change HTML\\\\n						this.parentNode.parentNode.removeChild(this.parentNode);\\\\n						this.last_hit.appendChild(this.parentNode);\\\\n\\\\n						// Change node structure\\\\n						xml_node.parentNode.removeChild(xml_node);\\\\n						target_xml_node.appendChild(xml_node);\\\\n\\\\n						// Ajax request\\\\n						eval('drag_'+xml_node.getAttribute('draggable')+'(\\\\\\\"'+xml_node.getAttribute('serverid')+'\\\\\\\",\\\\\\\"'+target_xml_node.getAttribute('serverid')+'\\\\\\\")');\\\\n\\\\n						fixup_node_positions(this.object.name);\\\\n					}\\\\n				}\\\\n			};\\\\n		}\\\\n\\\\n		if ((node.getAttribute('droppable')) && (node.getAttribute('droppable')!='false'))\\\\n		{\\\\n			node_self.ondragover=function(event) {\\\\n				if (typeof event.preventDefault!='undefined') event.preventDefault();\\\\n			};\\\\n			node_self.ondrop=function(event) {\\\\n				if (typeof event.preventDefault!='undefined') event.preventDefault();\\\\n				// ondragend will call with last_hit set, we don't track the drop spots using this event handler, we track it in real time using mouse coordinate analysis\\\\n			};\\\\n		}\\\\n\\\\n		if (initially_expanded)\\\\n		{\\\\n			this.render_tree(node,new_html,element);\\\\n		} else\\\\n		{\\\\n			if (new_html) set_inner_html(new_html,'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"PLEASE_WAIT\\\",array()),\\n	\\\"',true);\\\\n		}\\\\n	}\\\\n\\\\n	trigger_resize();\\\\n\\\\n	return a;\\\\n};\\\\n\\\\nfunction fixup_node_positions(name)\\\\n{\\\\n	var html=document.getElementById('tree_list__root_'+name);\\\\n	var to_fix=html.getElementsByTagName('div');\\\\n	var i;\\\\n	for (i=0;i<to_fix.length;i++)\\\\n	{\\\\n		if (to_fix[i].style.position=='absolute') fix_up_node_position(to_fix[i]);\\\\n	}\\\\n}\\\\n\\\\nfunction fix_up_node_position(node_self)\\\\n{\\\\n	node_self.style.left=find_pos_x(node_self.parentNode,true)+'px';\\\\n	node_self.style.top=find_pos_y(node_self.parentNode,true)+'px';\\\\n}\\\\n\\\\nfunction find_overlapping_selectable(mouse_y,element,node,name) // Find drop targets\\\\n{\\\\n	var i,childNode,temp,child_node_element,y,height;\\\\n\\\\n	// Recursion\\\\n	if (node.getAttribute('expanded')!=='false')\\\\n	{\\\\n		for (i=0;i<node.childNodes.length;i++)\\\\n		{\\\\n			childNode=node.childNodes[i];\\\\n			if (childNode.nodeName=='#text') continue; // A text-node\\\\n\\\\n			temp=find_overlapping_selectable(mouse_y,element,childNode,name);\\\\n			if (temp) return temp;\\\\n		}\\\\n	}\\\\n\\\\n	if (node.getAttribute('droppable')==element.cms_draggable)\\\\n	{\\\\n		child_node_element=document.getElementById(name+'tree_list_'+((node.nodeName.toLowerCase()=='category')?'c':'e')+'_'+node.getAttribute('id'));\\\\n		y=find_pos_y(child_node_element.parentNode.parentNode,true);\\\\n		height=find_height(child_node_element.parentNode.parentNode);\\\\n		if ((y<mouse_y) && (y+height>mouse_y))\\\\n		{\\\\n			return child_node_element;\\\\n		}\\\\n	}\\\\n\\\\n	return null;\\\\n}\\\\n\\\\ntree_list.prototype.handle_tree_click=function(event,automated) // Not called as a method\\\\n{\\\\n	if (typeof window.do_ajax_request=='undefined') return false;\\\\n\\\\n	var element=document.getElementById(this.object.name);\\\\n	if (element.disabled) return false;\\\\n\\\\n	if (this.object.busy) return false;\\\\n	this.object.busy=true;\\\\n\\\\n	var clicked_id=this.getAttribute('id').substr(7+this.object.name.length);\\\\n\\\\n	var html_node=document.getElementById(this.object.name+'tree_list_c_'+clicked_id);\\\\n	var expand_button=document.getElementById(this.object.name+'texp_c_'+clicked_id);\\\\n\\\\n	var expanding=(html_node.style.display!='block');\\\\n\\\\n	if (expanding)\\\\n	{\\\\n		var xml_node=this.object.getElementByIdHack(clicked_id,'c');\\\\n		xml_node.setAttribute('expanded','true');\\\\n		var real_clicked_id=xml_node.getAttribute('serverid');\\\\n		if ((typeof real_clicked_id).toLowerCase()!='string') real_clicked_id=clicked_id;\\\\n\\\\n		/*if ((xml_node.getAttribute('draggable')) && (xml_node.getAttribute('draggable')!='false'))\\\\n		{\\\\n			html_node.parentNode.style.position='static';\\\\n		}*/\\\\n\\\\n		if ((xml_node.getAttribute('has_children')=='true') && (!has_child_nodes(xml_node)))\\\\n		{\\\\n			var url='/'+this.object.hook+'&id='+window.encodeURIComponent(real_clicked_id)+'&options='+this.object.options+'&default='+window.encodeURIComponent(element.value);\\\\n			var ob=this.object;\\\\n			do_ajax_request(url,function (ajax_result_frame,ajax_result) { set_inner_html(html_node,''); ob.response(ajax_result_frame,ajax_result,clicked_id); });\\\\n			set_inner_html(html_node,'<div aria-busy=\\\\\\\"true\\\\\\\" class=\\\\\\\"vertical_alignment\\\\\\\"><img src=\\\\\\\"'+'\\\",\\n	ecv_IMG(\\\$cl,array(1,2),array(\\\"loading\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"'.replace(/^https?:/,window.location.protocol)+'\\\\\\\" alt=\\\\\\\"\\\\\\\" /> <span>\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"LOADING\\\",array()),\\n	\\\"</span></div>');\\\\n			var container=document.getElementById('tree_list__root_'+ob.name);\\\\n			if ((automated) && (container) && (container.style.overflowY=='auto'))\\\\n			{\\\\n				window.setTimeout(function() {\\\\n					container.scrollTop=find_pos_y(html_node)-20;\\\\n				}, 0);\\\\n			}\\\\n		}\\\\n\\\\n		html_node.style.display='block';\\\\n		if (typeof window.fade_transition!='undefined')\\\\n		{\\\\n			set_opacity(html_node,0.0);\\\\n			fade_transition(html_node,100,30,4);\\\\n		}\\\\n\\\\n		expand_button.src='\\\",\\n	ecv_IMG(\\\$cl,array(2),array(\\\"1x/treefield/collapse\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"'.replace(/^https?:/,window.location.protocol);\\\\n		expand_button.srcset='\\\",\\n	ecv_IMG(\\\$cl,array(2),array(\\\"2x/treefield/collapse\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"'.replace(/^https?:/,window.location.protocol)+' 2x';\\\\n		expand_button.title=expand_button.title.replace('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"EXPAND\\\",array()),\\n	\\\"','\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"CONTRACT\\\",array()),\\n	\\\"');\\\\n		expand_button.alt=expand_button.alt.replace('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"EXPAND\\\",array()),\\n	\\\"','\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"CONTRACT\\\",array()),\\n	\\\"');\\\\n	} else\\\\n	{\\\\n		var xml_node=this.object.getElementByIdHack(clicked_id,'c');\\\\n		xml_node.setAttribute('expanded','false');\\\\n\\\\n		/*if ((xml_node.getAttribute('draggable')) && (xml_node.getAttribute('draggable')!='false'))\\\\n		{\\\\n			html_node.parentNode.style.position='absolute';\\\\n		}*/\\\\n\\\\n		html_node.style.display='none';\\\\n\\\\n		expand_button.src='\\\",\\n	ecv_IMG(\\\$cl,array(2),array(\\\"1x/treefield/expand\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"'.replace(/^https?:/,window.location.protocol);\\\\n		expand_button.srcset='\\\",\\n	ecv_IMG(\\\$cl,array(2),array(\\\"2x/treefield/expand\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")),\\n	\\\"'.replace(/^https?:/,window.location.protocol)+' 2x';\\\\n		expand_button.title=expand_button.title.replace('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"CONTRACT\\\",array()),\\n	\\\"','\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"EXPAND\\\",array()),\\n	\\\"');\\\\n		expand_button.alt=expand_button.alt.replace('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"CONTRACT\\\",array()),\\n	\\\"','\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"EXPAND\\\",array()),\\n	\\\"');\\\\n	}\\\\n\\\\n	fixup_node_positions(this.object.name);\\\\n\\\\n	trigger_resize();\\\\n\\\\n	this.object.busy=false;\\\\n\\\\n	return true;\\\\n};\\\\n\\\\ntree_list.prototype.handle_selection=function(event,assume_ctrl) // Not called as a method\\\\n{\\\\n	if (typeof event=='undefined') event=window.event;\\\\n	if (typeof assume_ctrl=='undefined') assume_ctrl=false;\\\\n\\\\n	var element=document.getElementById(this.object.name);\\\\n	if (element.disabled) return;\\\\n	var i;\\\\n	var selected_before=(element.value=='')?[]:(this.object.multi_selection?element.value.split(','):[element.value]);\\\\n\\\\n	cancel_bubbling(event);\\\\n	if (typeof event.preventDefault!='undefined') event.preventDefault();\\\\n\\\\n	if ((!assume_ctrl) && (event.shiftKey) && (this.object.multi_selection))\\\\n	{\\\\n		// We're holding down shift so we need to force selection of everything bounded between our last click spot and here\\\\n		var all_a=document.getElementById('tree_list__root_'+this.object.name).getElementsByTagName('label');\\\\n		var pos_last=-1;\\\\n		var pos_us=-1;\\\\n		if (this.object.last_clicked==null) this.object.last_clicked=all_a[0];\\\\n		for (i=0;i<all_a.length;i++)\\\\n		{\\\\n			if (all_a[i]==this || all_a[i]==this.parentNode) pos_us=i;\\\\n			if (all_a[i]==this.object.last_clicked || all_a[i]==this.object.last_clicked.parentNode) pos_last=i;\\\\n		}\\\\n		if (pos_us<pos_last) // ReOrder them\\\\n		{\\\\n			var temp=pos_us;\\\\n			pos_us=pos_last;\\\\n			pos_last=temp;\\\\n		}\\\\n		var that_selected_id,that_xml_node,that_type;\\\\n		for (i=0;i<all_a.length;i++)\\\\n		{\\\\n			that_type=this.getAttribute('id').charAt(5+this.object.name.length);\\\\n			if (that_type=='r') that_type='c';\\\\n			if (that_type=='s') that_type='e';\\\\n\\\\n			if (all_a[i].getAttribute('id').substr(5+this.object.name.length,that_type.length)==that_type)\\\\n			{\\\\n				that_selected_id=(this.object.use_server_id)?all_a[i].getAttribute('serverid'):all_a[i].getAttribute('id').substr(7+this.object.name.length);\\\\n				that_xml_node=this.object.getElementByIdHack(that_selected_id,that_type);\\\\n				if ((that_xml_node.getAttribute('selectable')=='true') || (this.object.all_nodes_selectable))\\\\n				{\\\\n					if ((i>=pos_last) && (i<=pos_us))\\\\n					{\\\\n						if (selected_before.indexOf(that_selected_id)==-1)\\\\n							all_a[i].handle_selection(event,true);\\\\n					} else\\\\n					{\\\\n						if (selected_before.indexOf(that_selected_id)!=-1)\\\\n							all_a[i].handle_selection(event,true);\\\\n					}\\\\n				}\\\\n			}\\\\n		}\\\\n\\\\n		return;\\\\n	}\\\\n	var type=this.getAttribute('id').charAt(5+this.object.name.length);\\\\n	if (type=='r') type='c';\\\\n	if (type=='s') type='e';\\\\n	var real_selected_id=this.getAttribute('id').substr(7+this.object.name.length);\\\\n	var xml_node=this.object.getElementByIdHack(real_selected_id,type);\\\\n	var selected_id=(this.object.use_server_id)?xml_node.getAttribute('serverid'):real_selected_id;\\\\n\\\\n	if (xml_node.getAttribute('selectable')=='true' || this.object.all_nodes_selectable)\\\\n	{\\\\n		var selected_after=selected_before;\\\\n		for (i=0;i<selected_before.length;i++)\\\\n		{\\\\n			this.object.make_element_look_selected(document.getElementById(this.object.name+'tsel_'+type+'_'+selected_before[i]),false);\\\\n		}\\\\n		if ((!this.object.multi_selection) || (((!event.ctrlKey) && (!event.metaKey) && (!event.altKey)) && (!assume_ctrl)))\\\\n		{\\\\n			selected_after=[];\\\\n		}\\\\n		if ((selected_before.indexOf(selected_id)!=-1) && (((selected_before.length==1) && (selected_before[0]!=selected_id)) || ((event.ctrlKey) || (event.metaKey) || (event.altKey)) || (assume_ctrl)))\\\\n		{\\\\n			for (var key in selected_after)\\\\n			{\\\\n				if (selected_after[key]==selected_id)\\\\n					selected_after.splice(key,1);\\\\n			}\\\\n		} else\\\\n		if (selected_after.indexOf(selected_id)==-1)\\\\n		{\\\\n			selected_after.push(selected_id);\\\\n			if (!this.object.multi_selection) // This is a bit of a hack to make selection look nice, even though we aren't storing natural IDs of what is selected\\\\n			{\\\\n				var anchors=document.getElementById('tree_list__root_'+this.object.name).getElementsByTagName('label');\\\\n				for (i=0;i<anchors.length;i++)\\\\n				{\\\\n					this.object.make_element_look_selected(anchors[i],false);\\\\n				}\\\\n				this.object.make_element_look_selected(document.getElementById(this.object.name+'tsel_'+type+'_'+real_selected_id),true);\\\\n			}\\\\n		}\\\\n		for (i=0;i<selected_after.length;i++)\\\\n		{\\\\n			this.object.make_element_look_selected(document.getElementById(this.object.name+'tsel_'+type+'_'+selected_after[i]),true);\\\\n		}\\\\n\\\\n		element.value=selected_after.join(',');\\\\n		element.selected_title=(selected_after.length==1)?xml_node.getAttribute('title'):element.value;\\\\n		element.selected_editlink=xml_node.getAttribute('edit');\\\\n		if (element.value=='') element.selected_title='';\\\\n		if (element.onchange) element.onchange();\\\\n		if (typeof element.fakeonchange!='undefined' && element.fakeonchange) element.fakeonchange();\\\\n	}\\\\n\\\\n	if (/*(!event.ctrlKey) && */(!assume_ctrl)) this.object.last_clicked=this;\\\\n};\\\\n\\\\ntree_list.prototype.make_element_look_selected=function(target,selected)\\\\n{\\\\n	if (!target) return;\\\\n	if (!selected)\\\\n	{\\\\n		target.className=target.className.replace(/ native_ui_selected/g,'');\\\\n	} else\\\\n	{\\\\n		target.className+=' native_ui_selected';\\\\n	}\\\\n	target.style.cursor='pointer';\\\\n};\\\\n\\\\n\\\\n\\\";\");\";}}");

