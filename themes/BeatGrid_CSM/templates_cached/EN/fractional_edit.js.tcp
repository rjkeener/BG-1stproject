<?php
return unserialize("a:5:{i:0;a:1:{i:0;a:1:{i:0;a:5:{i:0;s:33:\"tcpfunc_5ac68f246d6c19.01245206_1\";i:1;a:0:{}i:2;i:1;i:3;s:0:\"\";i:4;s:0:\"\";}}}i:1;a:0:{}i:2;s:15:\"fractional_edit\";i:3;N;i:4;a:1:{s:33:\"tcpfunc_5ac68f246d6c19.01245206_1\";s:7517:\"\$tpl_funcs['tcpfunc_5ac68f246d6c19.01245206_1']=\$KEEP_TPL_FUNCS['tcpfunc_5ac68f246d6c19.01245206_1']=recall_named_function('5ac68f246d6d21.72148821','\$parameters,\$cl',\"echo \\\"\\\\\\\"use strict\\\\\\\";\\\\n\\\\nfunction fractional_edit(event,object,url,raw_text,edit_param_name,was_double_click,control_button,type)\\\\n{\\\\n	if (typeof was_double_click=='undefined') was_double_click=false;\\\\n	if (typeof control_button=='undefined') control_button=null;\\\\n	if (typeof type=='undefined') type='line';\\\\n\\\\n	if ((magic_keypress(event)) || (was_double_click) || (object!=event.target))\\\\n	{\\\\n		cancel_bubbling(event);\\\\n		if (typeof event.preventDefault!='undefined') event.preventDefault();\\\\n\\\\n		// Position form\\\\n		var width=find_width(object);\\\\n		if (width<160) width=160;\\\\n		var x=find_pos_x(object,true);\\\\n		var y=find_pos_y(object,true)-8;\\\\n\\\\n		// Record old JS events\\\\n		object.old_onclick=object.onclick;\\\\n		object.old_ondblclick=object.ondblclick;\\\\n		object.old_onkeypress=object.onkeypress;\\\\n\\\\n		// Create form\\\\n		var form=document.createElement('form'); // The form is never submitted actually: we use XMLHttpRequest\\\\n		form.method='post';\\\\n		form.action=url;\\\\n		form.style.display='inline';\\\\n		var populated_value;\\\\n		if (typeof object.raw_text!='undefined')\\\\n		{\\\\n			populated_value=object.raw_text; // Our previous text edited in this JS session\\\\n		} else\\\\n		{\\\\n			object.raw_text=raw_text;\\\\n			populated_value=raw_text; // What was in the DB when the screen loaded\\\\n		}\\\\n		var input;\\\\n		switch (type)\\\\n		{\\\\n			case 'line':\\\\n				input=document.createElement('input');\\\\n				if (raw_text.length>255)\\\\n				{\\\\n					input.setAttribute('size','30');\\\\n				} else\\\\n				{\\\\n					input.setAttribute('maxlength','255');\\\\n				}\\\\n				input.value=populated_value;\\\\n				break;\\\\n			case 'textarea':\\\\n				input=document.createElement('textarea');\\\\n				input.value=populated_value;\\\\n				input.rows='6';\\\\n				break;\\\\n			default:\\\\n				input=document.createElement('select');\\\\n				var list_options=type.split('|');\\\\n				var list_option;\\\\n				for (var i=0;i<list_options.length;i++)\\\\n				{\\\\n					list_option=document.createElement('option');\\\\n					set_inner_html(list_option,escape_html(list_options[i]));\\\\n					list_option.selected=(populated_value==list_options[i]);\\\\n					input.appendChild(list_option);\\\\n				}\\\\n				break;\\\\n		}\\\\n		input.style.position='absolute';\\\\n		\\\",\\n	((ecv_MOBILE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n			input.style.left='0px';\\\\n			input.style.width=get_window_width()+'px';\\\\n		\\\"):''),\\n	\\\"\\\\n		\\\",\\n	((ecv_NOT(\\\$cl,array(),array(ecv_MOBILE(\\\$cl,array(),array())))==\\\"1\\\")?(\\\"\\\\n			input.style.left=(x)+'px';\\\\n			if (raw_text.length<=255) input.style.width=width+'px';\\\\n		\\\"):''),\\n	\\\"\\\\n		input.style.top=(y+8)+'px';\\\\n		input.style.margin=0;\\\\n		var to_copy=['font-size','font-weight','font-style'];\\\\n		if (type=='line')\\\\n		{\\\\n			to_copy.push('border');\\\\n			to_copy.push('border-top');\\\\n			to_copy.push('border-right');\\\\n			to_copy.push('border-bottom');\\\\n			to_copy.push('border-left');\\\\n		}\\\\n		for (var i=0;i<to_copy.length;i++)\\\\n		{\\\\n			var style=abstract_get_computed_style(object.parentNode,to_copy[i]);\\\\n			if (typeof style!='undefined') input.style[to_copy[i]]=style;\\\\n		}\\\\n		input.name=edit_param_name;\\\\n		form.onsubmit=function(event) { return false; };\\\\n		if (control_button) set_inner_html(control_button,'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"SAVE\\\",array()),\\n	\\\"');\\\\n\\\\n		var cleanup_function=function() {\\\\n			object.onclick=object.old_onclick;\\\\n			object.ondblclick=object.old_ondblclick;\\\\n			object.onkeypress=object.old_onkeypress;\\\\n\\\\n			if (input.form.parentNode)\\\\n			{\\\\n				input.onblur=null; // So don't get recursion\\\\n				input.form.parentNode.removeChild(input.form);\\\\n			}\\\\n\\\\n			if (control_button)\\\\n			{\\\\n				set_inner_html(control_button,'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"EDIT\\\",array()),\\n	\\\"');\\\\n\\\\n				// To stop it instantly re-clicking\\\\n				var backup=control_button.onclick;\\\\n				control_button.onclick=function() { return false; };\\\\n				window.setTimeout(function() {\\\\n					control_button.onclick=backup;\\\\n				},10);\\\\n			}\\\\n		};\\\\n\\\\n		var cancel_function=function() {\\\\n			cleanup_function();\\\\n\\\\n			window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"FRACTIONAL_EDIT_CANCELLED\\\",array()),\\n	\\\"',null,'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"FRACTIONAL_EDIT\\\",array()),\\n	\\\"');\\\\n\\\\n			return false;\\\\n		};\\\\n\\\\n		var save_function=function() {\\\\n			// Call AJAX request\\\\n			var response=do_ajax_request(input.form.action,null,input.name+'='+window.encodeURIComponent(input.value));\\\\n\\\\n			// Some kind of error?\\\\n			if (((response.responseText=='') && (input.value!='')) || (response.status!=200))\\\\n			{\\\\n				var session_test_url='\\\",\\n	ecv_FIND_SCRIPT_NOHTTP(\\\$cl,array(2),array(\\\"confirm_session\\\")),\\n	\\\"';\\\\n				var session_test_ret=do_ajax_request(session_test_url+keep_stub(true),null);\\\\n\\\\n				if ((session_test_ret.responseText!='') && (session_test_ret.responseText!=null)) // If it failed, see if it is due to a non-confirmed session\\\\n				{\\\\n					confirm_session(\\\\n						function(result)\\\\n						{\\\\n							if (result)\\\\n							{\\\\n								save_function();\\\\n							} else\\\\n							{\\\\n								cleanup_function();\\\\n							}\\\\n						}\\\\n					);\\\\n				} else\\\\n				{\\\\n					cleanup_function(); // Has to happen before, as that would cause defocus then refocus, causing a second save attempt\\\\n\\\\n					window.fauxmodal_alert((response.status==500)?response.responseText:'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"ERROR_FRACTIONAL_EDIT\\\",array()),\\n	\\\"',null,'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"FRACTIONAL_EDIT\\\",array()),\\n	\\\"');\\\\n				}\\\\n			} else // Success\\\\n			{\\\\n				object.raw_text=input.value;\\\\n				set_inner_html(object,response.responseText);\\\\n\\\\n				cleanup_function();\\\\n			}\\\\n\\\\n			return false;\\\\n		};\\\\n\\\\n		// If we activate it again, we actually treat this as a cancellation\\\\n		object.onclick=object.ondblclick=function(event)\\\\n			{\\\\n				if (typeof event=='undefined') event=window.event;\\\\n\\\\n				cancel_bubbling(event);\\\\n				if (typeof event.preventDefault!='undefined') event.preventDefault();\\\\n\\\\n				if (magic_keypress(event)) cleanup_function();\\\\n\\\\n				return false;\\\\n			};\\\\n\\\\n		// Cancel or save actions\\\\n		if (type=='line') input.onkeyup=function(event) // Not using onkeypress because that only works for actual represented characters in the input box\\\\n			{\\\\n				if (typeof event=='undefined') event=window.event;\\\\n				if (key_pressed(event,[27],true)) // Cancel (escape key)\\\\n				{\\\\n					var tmp=input.onblur;\\\\n					input.onblur=null;\\\\n					fauxmodal_confirm('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:FRACTIONAL_EDIT_CANCEL_CONFIRM\\\",array()),\\n	\\\"',function(result) {\\\\n						if (result)\\\\n						{\\\\n							cancel_function();\\\\n						} else\\\\n						{\\\\n							input.focus();\\\\n							input.onblur=tmp;\\\\n						}\\\\n					},'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"CONFIRM_TEXT\\\",array()),\\n	\\\"');\\\\n					return null;\\\\n				}\\\\n\\\\n				if ((enter_pressed(event)) && (this.value!='')) // Save\\\\n				{\\\\n					return save_function();\\\\n				}\\\\n\\\\n				return null;\\\\n			};\\\\n		input.onblur=function(event)\\\\n			{\\\\n				if (this.value!='' || raw_text=='') save_function(); else cancel_function();\\\\n			};\\\\n\\\\n		// Add in form\\\\n		form.appendChild(input);\\\\n		var website_inner=document.body;\\\\n		website_inner.appendChild(form);\\\\n		input.focus();\\\\n		if (typeof input.select!='undefined') input.select();\\\\n		return false;\\\\n	}\\\\n\\\\n	return null;\\\\n}\\\\n\\\\n\\\";\");\";}}");

