<?php
return unserialize("a:5:{i:0;a:1:{i:0;a:1:{i:0;a:5:{i:0;s:33:\"tcpfunc_5abfcf2eef42b5.17345057_1\";i:1;a:0:{}i:2;i:1;i:3;s:0:\"\";i:4;s:0:\"\";}}}i:1;a:0:{}i:2;s:11:\"modalwindow\";i:3;N;i:4;a:1:{s:33:\"tcpfunc_5abfcf2eef42b5.17345057_1\";s:41572:\"\$tpl_funcs['tcpfunc_5abfcf2eef42b5.17345057_1']=\$KEEP_TPL_FUNCS['tcpfunc_5abfcf2eef42b5.17345057_1']=recall_named_function('5abfcf2eef45e1.24057943','\$parameters,\$cl',\"echo \\\"/*\\\\n\\\\nThis file does a lot of stuff relating to overlays...\\\\n\\\\nIt provides callback-based *overlay*-driven substitutions for the standard browser windowing API...\\\\n - alert\\\\n - prompt\\\\n - confirm\\\\n - open (known as popups)\\\\n - showModalDialog\\\\nA term we are using for these kinds of 'overlay' is '(faux) modal window'.\\\\n\\\\nIt provides a generic function to open a link as an overlay.\\\\n\\\\nIt provides a function to open an image link as a 'lightbox' (we use the term lightbox exclusively to refer to images in an overlay).\\\\n\\\\n*/\\\\n\\\\nif (typeof window.overlay_zIndex=='undefined')\\\\n{\\\\n	window.overlay_zIndex=999999; // Has to be higher than plupload, which is 99999\\\\n}\\\\n\\\\nfunction open_link_as_overlay(ob,width,height,target)\\\\n{\\\\n	\\\",\\n	(\\\"\\\\n		if ((typeof width=='undefined') || (!width)) var width='800';\\\\n		if ((typeof height=='undefined') || (!height)) var height='auto';\\\\n		var url=(typeof ob.href=='undefined')?ob.action:ob.href;\\\\n		if (/:\\\\\\\\/\\\\\\\\/(.[^\\\\\\\\/]+)/.exec(url)[1]!=window.location.hostname) return true; // Cannot overlay, different domain\\\\n		if ((typeof target=='undefined') || (!target)) var target='_top';\\\\n		var url_stripped=url.replace(/#.*/,'');\\\\n		var new_url=url_stripped+((url_stripped.indexOf('?')==-1)?'?':'&')+'wide_high=1'+url.replace(/^[^\\\\\\\\#]+/,'');\\\\n		faux_open(new_url,null,'width='+width+';height='+height,target);\\\\n		return false;\\\\n	\\\"),\\n	\\\"\\\\n\\\\n	\\\",\\n	((ecv_NOT(\\\$cl,array(),array(\\\"1\\\"))==\\\"1\\\")?(\\\"\\\\n		return true;\\\\n	\\\"):''),\\n	\\\"\\\\n}\\\\n\\\\n\\\",\\n	(\\\"\\\\n	function open_images_into_lightbox(imgs,start)\\\\n	{\\\\n		if (typeof start=='undefined') start=0;\\\\n\\\\n		var modal=_open_image_into_lightbox(imgs[start][0],imgs[start][1],start+1,imgs.length,true,imgs[start][2]);\\\\n		modal.positionInSet=start;\\\\n\\\\n		var previous_button=document.createElement('img');\\\\n		previous_button.className='previous_button';\\\\n		previous_button.src='\\\".ecv_IMG(\\\$cl,array(2),array(\\\"mediaset_previous\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")).\\\"'.replace(/^https?:/,window.location.protocol);\\\\n		var previous=function(e) {\\\\n			if (typeof e=='undefined') e=window.event;\\\\n			cancel_bubbling(e);\\\\n\\\\n			var new_position=modal.positionInSet-1;\\\\n			if (new_position<0) new_position=imgs.length-1;\\\\n			modal.positionInSet=new_position;\\\\n			_open_different_image_into_lightbox(modal,new_position,imgs);\\\\n			return false;\\\\n		};\\\\n		previous_button.onclick=previous;\\\\n		modal.left=previous;\\\\n		modal.box_wrapper.childNodes[0].appendChild(previous_button);\\\\n\\\\n		var next_button=document.createElement('img');\\\\n		next_button.className='next_button';\\\\n		next_button.src='\\\".ecv_IMG(\\\$cl,array(2),array(\\\"mediaset_next\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")).\\\"'.replace(/^https?:/,window.location.protocol);\\\\n		var next=function(e) {\\\\n			if (typeof e=='undefined') e=window.event;\\\\n			cancel_bubbling(e);\\\\n\\\\n			var new_position=modal.positionInSet+1;\\\\n			if (new_position>=imgs.length) new_position=0;\\\\n			modal.positionInSet=new_position;\\\\n			_open_different_image_into_lightbox(modal,new_position,imgs);\\\\n			return false;\\\\n		};\\\\n		next_button.onclick=next;\\\\n		modal.right=next;\\\\n		modal.box_wrapper.childNodes[0].appendChild(next_button);\\\\n	}\\\\n\\\\n	function open_image_into_lightbox(a,is_video)\\\\n	{\\\\n		if (typeof is_video=='undefined') is_video=false;\\\\n		var has_full_button=(typeof a.childNodes[0]=='undefined') || (a.href!==a.childNodes[0].src);\\\\n		_open_image_into_lightbox(a.href,(typeof a.cms_tooltip_title!='undefined')?a.cms_tooltip_title:a.title,null,null,has_full_button,is_video);\\\\n	}\\\\n\\\\n	function _open_image_into_lightbox(initial_img_url,description,x,n,has_full_button,is_video)\\\\n	{\\\\n		if (typeof has_full_button=='undefined') has_full_button=false;\\\\n\\\\n		// Set up overlay for Lightbox\\\\n		var lightbox_code=' \\\\\\\\\\\\n			<div style=\\\\\\\"text-align: center\\\\\\\"> \\\\\\\\\\\\n				<p class=\\\\\\\"ajax_loading\\\\\\\" id=\\\\\\\"lightbox_image\\\\\\\"><img src=\\\\\\\"'+'\\\".ecv_IMG(\\\$cl,array(1,2),array(\\\"loading\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")).\\\"'.replace(/^https?:/,window.location.protocol)+'\\\\\\\" /></p> \\\\\\\\\\\\n				<p id=\\\\\\\"lightbox_meta\\\\\\\" style=\\\\\\\"display: none\\\\\\\" class=\\\\\\\"associated_link associated_links_block_group\\\\\\\"> \\\\\\\\\\\\n					<span id=\\\\\\\"lightbox_description\\\\\\\">'+description+'</span> \\\\\\\\\\\\n					'+((n===null)?'':('<span id=\\\\\\\"lightbox_position_in_set\\\\\\\"><span id=\\\\\\\"lightbox_position_in_set_x\\\\\\\">'+x+'</span> / <span id=\\\\\\\"lightbox_position_in_set_n\\\\\\\">'+n+'</span></span>'))+' \\\\\\\\\\\\n					'+(is_video?'':('<span id=\\\\\\\"lightbox_full_link\\\\\\\"><a href=\\\\\\\"'+escape_html(initial_img_url)+'\\\\\\\" target=\\\\\\\"_blank\\\\\\\" title=\\\\\\\"\\\".ecv_STRIP_TAGS(\\\$cl,array(2),array(\\\"See full image\\\")).\\\" \\\".ecv(\\\$cl,array(2,8),2,\\\"LINK_NEW_WINDOW\\\",array()).\\\"\\\\\\\">\\\".ecv(\\\$cl,array(2,8),2,\\\"SEE_FULL_IMAGE\\\",array()).\\\"</a></span>'))+' \\\\\\\\\\\\n				</p> \\\\\\\\\\\\n			</div> \\\\\\\\\\\\n		';\\\\n\\\\n		// Show overlay\\\\n		var my_lightbox={\\\\n			type: 'lightbox',\\\\n			text: lightbox_code,\\\\n			cancel_button: '\\\".ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CLOSE\\\",array()).\\\"',\\\\n			width: '450', // This will be updated with the real image width, when it has loaded\\\\n			height: '300' // \\\\\\\"\\\\n		};\\\\n		var modal=new ModalWindow();\\\\n		modal.open(my_lightbox);\\\\n\\\\n		// Load proper image\\\\n		window.setTimeout(function() { // Defer execution until the HTML was parsed\\\\n			if (is_video)\\\\n			{\\\\n				var video=document.createElement('video');\\\\n				video.controls='controls';\\\\n				video.autoplay='autoplay';\\\\n				set_inner_html(video,initial_img_url);\\\\n				video.className='lightbox_image';\\\\n				video.id='lightbox_image';\\\\n				add_event_listener_abstract(video,'loadedmetadata',function() { _resize_lightbox_dimensions_img(modal,video,has_full_button,true); });\\\\n			} else\\\\n			{\\\\n				var img=modal.top_window.document.createElement('img');\\\\n				img.className='lightbox_image';\\\\n				img.id='lightbox_image';\\\\n				img.onload=function() { _resize_lightbox_dimensions_img(modal,img,has_full_button,false); };\\\\n				img.src=initial_img_url;\\\\n			}\\\\n		},0);\\\\n\\\\n		return modal;\\\\n	}\\\\n\\\\n	function _open_different_image_into_lightbox(modal,position,imgs)\\\\n	{\\\\n		var is_video=imgs[position][2];\\\\n\\\\n		// Load proper image\\\\n		window.setTimeout(function() { // Defer execution until the HTML was parsed\\\\n			if (is_video)\\\\n			{\\\\n				var video=document.createElement('video');\\\\n				video.controls='controls';\\\\n				video.autoplay='autoplay';\\\\n				set_inner_html(video,imgs[position][0]);\\\\n				video.className='lightbox_image';\\\\n				video.id='lightbox_image';\\\\n				add_event_listener_abstract(video,'loadedmetadata',function() { _resize_lightbox_dimensions_img(modal,video,true,true); });\\\\n			} else\\\\n			{\\\\n				var img=modal.top_window.document.createElement('img');\\\\n				img.className='lightbox_image';\\\\n				img.id='lightbox_image';\\\\n				img.src='data:image/gif;base64,R0lGODlhFAAUANU9ANVoZshVVfO3trY6OfaWlqcmJu+ZmP3s6ulpZ/7h4edZVvXVx+2JifnZ2fXCweQzMdtxcfbMzOF9eu+hoK4cGuqEhOVIRsJMS/fW1rxDQv7w7uM/Pe6Ed+ylmfze3rMmJPOurut6evGxoupycud/f/ni3vrc3P3Qy288PPrLxfvm4+hgXvbd2a0vL++Pj/7Z1qEdHfGnp/y/uLgwLLQhHexxaeePhOZQTuB3d/uenuWTjc9eXVETE////wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFMgA9ACwAAAAAFAAUAAAGn8CecEgsGo/IpHLJFKJ40Kh0Gn2WTtis9pTqOlIiqCxHLhPOLheDUSGRbGLymZBWV9oSHA4iEaPVbCR5exAAADsAUAJrbYKEhoc7AQE7UCKOj5GTARcXGRdQHRCFkZKcnhkZA6tQOpqnqKsDLbQzUBKTnamytC0FvzAfUACpqqu9vwUwyzAUULEDM9IfHzQ0FNjYNDxPVN5SKE3i4+RCQQAh+QQFMgA9ACwBAAUABgAGAAAGGECNUHN4HRJIQe+YUC49oJ5UFZX2HFZpEAAh+QQFMgA9ACwBAAUACwALAAAGPMCesKcpFg+vYS/B9HhASqfTBB16TKZGI6bMNjCYiVKFiUQcOmWv5BCAKuoeKzYBxHsLxl3Yuex7AX89QQAh+QQFMgA9ACwBAAUAEAALAAAGTMCecDjUGDWHw4nI9JiejRiTaGpYMYbpsIHBRBw6rTDyFQgq4p5DAIrFJGJ2bGJwQdKGOoOUdjEqISMIGWIigQgICmk9HDUIKwoDi0EAIfkEBTIAPQAsBgAFAA0ACwAABkDAnnAo1PQOhxJx2cBgWMthJOJwdKI9h0AAkmBBsYkBghW7GAAsoxIa7bBtBAI7QqxWt1l0pbjdLC1YfRYbWEJBACH5BAUyAD0ALAkABQAKAAsAAAYuwJ5wOFQRj0jiItmLCZIGlwFZCY04RCsCsUIQVwrFzTIUjzebwtCCfjzWbTcxCAAh+QQFyAA9ACwPAAwABAAEAAAGDMCe8CZ8bHqPpPIRBAA7';\\\\n				window.setTimeout(function() { // Defer execution until after loading is set\\\\n					img.onload=function() { _resize_lightbox_dimensions_img(modal,img,true,is_video); };\\\\n					img.src=imgs[position][0];\\\\n				},0);\\\\n			}\\\\n\\\\n			var lightbox_description=modal.top_window.document.getElementById('lightbox_description');\\\\n			var lightbox_position_in_set_x=modal.top_window.document.getElementById('lightbox_position_in_set_x');\\\\n			if (lightbox_description) set_inner_html(lightbox_description,imgs[position][1]);\\\\n			if (lightbox_position_in_set_x) set_inner_html(lightbox_position_in_set_x,position+1);\\\\n		},0);\\\\n	}\\\\n\\\\n	function _resize_lightbox_dimensions_img(modal,img,has_full_button,is_video)\\\\n	{\\\\n		if (!modal.box_wrapper) return; /* Overlay closed already */\\\\n\\\\n		var real_width=is_video?img.videoWidth:img.width;\\\\n		var width=real_width;\\\\n		var real_height=is_video?img.videoHeight:img.height;\\\\n		var height=real_height;\\\\n\\\\n		var max_dims=_get_max_lightbox_img_dims(modal,has_full_button);\\\\n		var max_width=max_dims[0];\\\\n		var max_height=max_dims[1];\\\\n\\\\n		var lightbox_image=modal.top_window.document.getElementById('lightbox_image');\\\\n\\\\n		var lightbox_meta=modal.top_window.document.getElementById('lightbox_meta');\\\\n		var lightbox_description=modal.top_window.document.getElementById('lightbox_description');\\\\n		var lightbox_position_in_set=modal.top_window.document.getElementById('lightbox_position_in_set');\\\\n		var lightbox_full_link=modal.top_window.document.getElementById('lightbox_full_link');\\\\n\\\\n		var dims_func=function()\\\\n		{\\\\n			lightbox_description.style.display=(lightbox_description.childNodes.length>0)?'inline':'none';\\\\n			if (lightbox_full_link) lightbox_full_link.style.display=(!is_video && has_full_button && (real_width>max_width || real_height>max_height))?'inline':'none';\\\\n			lightbox_meta.style.display=(lightbox_description.style.display=='inline' || lightbox_position_in_set!==null || lightbox_full_link && lightbox_full_link.style.display=='inline')?'block':'none';\\\\n\\\\n			// Might need to rescale using some maths, if natural size is too big\\\\n			var max_dims=_get_max_lightbox_img_dims(modal,has_full_button);\\\\n			var max_width=max_dims[0];\\\\n			var max_height=max_dims[1];\\\\n			if (width>max_width)\\\\n			{\\\\n				width=max_width;\\\\n				height=window.parseInt(max_width*real_height/real_width-1);\\\\n			}\\\\n			if (height>max_height)\\\\n			{\\\\n				width=window.parseInt(max_height*real_width/real_height-1);\\\\n				height=max_height;\\\\n			}\\\\n\\\\n			img.width=width;\\\\n			img.height=height;\\\\n			modal.reset_dimensions(''+width,''+height,false,true); // Temporarily forced, until real height is known (includes extra text space etc)\\\\n\\\\n			window.setTimeout(function() {\\\\n				modal.reset_dimensions(''+width,''+height,false);\\\\n			},0);\\\\n\\\\n			if (img.parentNode)\\\\n			{\\\\n				img.parentNode.parentNode.parentNode.style.width='auto';\\\\n				img.parentNode.parentNode.parentNode.style.height='auto';\\\\n			}\\\\n		};\\\\n\\\\n		var sup=lightbox_image.parentNode;\\\\n		sup.removeChild(lightbox_image);\\\\n		if (sup.childNodes.length!=0)\\\\n		{\\\\n			sup.insertBefore(img,sup.childNodes[0]);\\\\n		} else\\\\n		{\\\\n			sup.appendChild(img);\\\\n		}\\\\n		sup.className='';\\\\n		sup.style.textAlign='center';\\\\n		sup.style.overflow='hidden';\\\\n\\\\n		dims_func();\\\\n		modal.add_event( window, 'resize', function() { dims_func(); });\\\\n	}\\\\n\\\\n	function _get_max_lightbox_img_dims(modal,has_full_button)\\\\n	{\\\\n		var max_width=modal.top_window.get_window_width()-20;\\\\n		var max_height=modal.top_window.get_window_height()-60;\\\\n		if (has_full_button) max_height-=120;\\\\n		return [max_width,max_height];\\\\n	}\\\\n\\\"),\\n	\\\"\\\\n\\\\nfunction fauxmodal_confirm(question,callback,title)\\\\n{\\\\n	if (typeof title=='undefined') title='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"Q_SURE\\\",array()),\\n	\\\"';\\\\n\\\\n	\\\",\\n	(\\\"\\\\n		var my_confirm={\\\\n			type: 'confirm',\\\\n			text: escape_html(question).replace(/\\\\\\\\n/g,'<br />'),\\\\n			yes_button: '\\\".ecv(\\\$cl,array(2,8),2,\\\"YES\\\",array()).\\\"',\\\\n			no_button: '\\\".ecv(\\\$cl,array(2,8),2,\\\"NO\\\",array()).\\\"',\\\\n			cancel_button: null,\\\\n			title: title,\\\\n			yes: function() {\\\\n				callback(true);\\\\n			},\\\\n			no: function() {\\\\n				callback(false);\\\\n			},\\\\n			width: '450'\\\\n		};\\\\n		new ModalWindow().open(my_confirm);\\\\n	\\\"),\\n	\\\"\\\\n\\\\n	\\\",\\n	((ecv_NOT(\\\$cl,array(),array(\\\"1\\\"))==\\\"1\\\")?(\\\"\\\\n		callback(window.confirm(question));\\\\n	\\\"):''),\\n	\\\"\\\\n}\\\\n\\\\nfunction fauxmodal_alert(notice,callback,title,unescaped)\\\\n{\\\\n	if ((typeof callback=='undefined') || (!callback)) var callback=function() {};\\\\n\\\\n	if (typeof title=='undefined' || title===null) var title='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"MESSAGE\\\",array()),\\n	\\\"';\\\\n	if (typeof unescaped=='undefined') unescaped=false;\\\\n\\\\n	\\\",\\n	(\\\"\\\\n		var my_alert={\\\\n			type: 'alert',\\\\n			text: unescaped?notice:escape_html(notice).replace(/\\\\\\\\n/g,'<br />'),\\\\n			yes_button: '\\\".ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_OK\\\",array()).\\\"',\\\\n			width: '600',\\\\n			yes: callback,\\\\n			title: title,\\\\n			cancel_button: null\\\\n		};\\\\n		new ModalWindow().open(my_alert);\\\\n	\\\"),\\n	\\\"\\\\n\\\\n	\\\",\\n	((ecv_NOT(\\\$cl,array(),array(\\\"1\\\"))==\\\"1\\\")?(\\\"\\\\n		if ((typeof window.alert!='undefined') && (window.alert!=null))\\\\n		{\\\\n			window.alert(notice);\\\\n		} else\\\\n		{\\\\n			console.log(notice);\\\\n		}\\\\n		callback();\\\\n	\\\"):''),\\n	\\\"\\\\n}\\\\n\\\\nfunction fauxmodal_prompt(question,defaultValue,callback,title,input_type)\\\\n{\\\\n	\\\",\\n	(\\\"\\\\n		var my_prompt={\\\\n			type: 'prompt',\\\\n			text: escape_html(question).replace(/\\\\\\\\n/g,'<br />'),\\\\n			yes_button: '\\\".ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_OK\\\",array()).\\\"',\\\\n			cancel_button: '\\\".ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()).\\\"',\\\\n			defaultValue: (defaultValue===null)?'':defaultValue,\\\\n			title: title,\\\\n			yes: function(value) {\\\\n				callback(value);\\\\n			},\\\\n			cancel: function() {\\\\n				callback(null);\\\\n			},\\\\n			width: '450'\\\\n		};\\\\n		if (input_type) my_prompt.input_type=input_type;\\\\n		new ModalWindow().open(my_prompt);\\\\n	\\\"),\\n	\\\"\\\\n\\\\n	\\\",\\n	((ecv_NOT(\\\$cl,array(),array(\\\"1\\\"))==\\\"1\\\")?(\\\"\\\\n		callback(window.prompt(question,defaultValue));\\\\n	\\\"):''),\\n	\\\"\\\\n}\\\\n\\\\nfunction faux_showModalDialog(url,name,options,callback,target,cancel_text)\\\\n{\\\\n	if ((typeof callback=='undefined') || (!callback)) var callback=function() {};\\\\n\\\\n	\\\",\\n	(\\\"\\\\n		var width=null,height=null,scrollbars=null,unadorned=null;\\\\n\\\\n		if (typeof cancel_text=='undefined') cancel_text='\\\".ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()).\\\"';\\\\n\\\\n		if (options)\\\\n		{\\\\n			var parts=options.split(/[;,]/g);\\\\n			for (var i=0;i<parts.length;i++)\\\\n			{\\\\n				var bits=parts[i].split('=');\\\\n				if (typeof bits[1]!='undefined')\\\\n				{\\\\n					if ((bits[0]=='dialogWidth') || (bits[0]=='width'))\\\\n						width=bits[1].replace(/px\\\\\\\$/,'');\\\\n					if ((bits[0]=='dialogHeight') || (bits[0]=='height'))\\\\n					{\\\\n						if (bits[1]=='100%')\\\\n						{\\\\n							height=''+(get_window_height()-200);\\\\n						} else\\\\n						{\\\\n							height=bits[1].replace(/px\\\\\\\$/,'');\\\\n						}\\\\n					}\\\\n					if (((bits[0]=='resizable') || (bits[0]=='scrollbars')) && scrollbars!==true)\\\\n						scrollbars=((bits[1]=='yes') || (bits[1]=='1'))/*if either resizable or scrollbars set we go for scrollbars*/;\\\\n					if (bits[0]=='unadorned') unadorned=((bits[1]=='yes') || (bits[1]=='1'));\\\\n				}\\\\n			}\\\\n		}\\\\n\\\\n		if (url.indexOf(window.location.host)!=-1)\\\\n		{\\\\n			url+=((url.indexOf('?')==-1)?'?':'&')+'overlay=1';\\\\n		}\\\\n\\\\n		var my_frame={\\\\n			type: 'iframe',\\\\n			finished: function(value) {\\\\n				callback(value);\\\\n			},\\\\n			name: name,\\\\n			width: width,\\\\n			height: height,\\\\n			scrollbars: scrollbars,\\\\n			href: url.replace(/^https?:/,window.location.protocol)\\\\n		};\\\\n		my_frame.cancel_button=(unadorned!==true)?cancel_text:null;\\\\n		if (target) my_frame.target=target;\\\\n		new ModalWindow().open(my_frame);\\\\n	\\\"),\\n	\\\"\\\\n\\\\n	\\\",\\n	((ecv_NOT(\\\$cl,array(),array(\\\"1\\\"))==\\\"1\\\")?(\\\"\\\\n		options=options.replace('height=auto','height=520');\\\\n\\\\n		var timer=new Date().getTime();\\\\n		try\\\\n		{\\\\n			var result=window.showModalDialog(url,name,options);\\\\n		}\\\\n		catch (e) {} // IE gives \\\\\\\"Access is denied\\\\\\\" if popup was blocked, due to var result assignment to non-real window\\\\n		var timer_now=new Date().getTime();\\\\n		if (timer_now-100>timer) // Not popup blocked\\\\n		{\\\\n			if ((typeof result=='undefined') || (result===null))\\\\n			{\\\\n				callback(null);\\\\n			} else\\\\n			{\\\\n				callback(result);\\\\n			}\\\\n		}\\\\n	\\\"):''),\\n	\\\"\\\\n}\\\\n\\\\nfunction faux_open(url,name,options,target,cancel_text)\\\\n{\\\\n	if (typeof cancel_text=='undefined') cancel_text='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"';\\\\n\\\\n	\\\",\\n	(\\\"\\\\n		faux_showModalDialog(url,name,options,null,target,cancel_text);\\\\n	\\\"),\\n	\\\"\\\\n\\\\n	\\\",\\n	((ecv_NOT(\\\$cl,array(),array(\\\"1\\\"))==\\\"1\\\")?(\\\"\\\\n		options=options.replace('height=auto','height=520');\\\\n		window.open(url,name,options);\\\\n	\\\"):''),\\n	\\\"\\\\n}\\\\n\\\\n\\\",\\n	(\\\"\\\\n/*\\\\nOriginally...\\\\n\\\\nScript: modalwindow.js\\\\n	ModalWindow - Simple javascript popup overlay to replace builtin alert, prompt and confirm, and more.\\\\n\\\\nLicense:\\\\n	PHP-style license.\\\\n\\\\nCopyright:\\\\n	Copyright (c) 2009 [Kieron Wilson](http://kd3sign.co.uk/).\\\\n\\\\nCode & Documentation:\\\\n	http://kd3sign.co.uk/examples/modalwindow/\\\\n\\\\nHEAVILY Modified by ocProducts for Composr.\\\\n\\\\n*/\\\\n\\\\nfunction ModalWindow()\\\\n{\\\\n	return {\\\\n		// Constants\\\\n		WINDOW_SIDE_GAP: \\\".(((ecv_MOBILE(\\\$cl,array(),array()))==\\\"1\\\")?(\\\"5\\\"):(\\\"25\\\")).\\\",\\\\n		WINDOW_TOP_GAP: 25, // Will also be used for bottom gap for percentage heights\\\\n		BOX_EAST_PERIPHERARY: 4,\\\\n		BOX_WEST_PERIPHERARY: 4,\\\\n		BOX_NORTH_PERIPHERARY: 4,\\\\n		BOX_SOUTH_PERIPHERARY: 4,\\\\n		VCENTRE_FRACTION_SHIFT: 0.5, // Fraction of remaining top gap also removed (as overlays look better slightly higher than vertical centre)\\\\n		LOADING_SCREEN_HEIGHT: 100,\\\\n\\\\n		// Properties\\\\n		box_wrapper: null,\\\\n		button_container: null,\\\\n		returnValue: null,\\\\n		top_window: null,\\\\n		iframe_restyle_timer: null,\\\\n\\\\n		// Methods...\\\\n\\\\n		open: function() {\\\\n			var options=arguments[0] || {};\\\\n			var defaults={\\\\n				'type': 'alert',\\\\n				'opacity': '0.5',\\\\n				'width': 'auto',\\\\n				'height': 'auto',\\\\n				'title': '',\\\\n				'text': '',\\\\n				'yes_button': '\\\".ecv(\\\$cl,array(2,8),2,\\\"YES\\\",array()).\\\"',\\\\n				'no_button': '\\\".ecv(\\\$cl,array(2,8),2,\\\"NO\\\",array()).\\\"',\\\\n				'cancel_button': '\\\".ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()).\\\"',\\\\n				'yes': null,\\\\n				'no': null,\\\\n				'finished': null,\\\\n				'cancel': null,\\\\n				'href': null,\\\\n				'scrollbars': null,\\\\n				'defaultValue': null,\\\\n				'target': '_self',\\\\n				'input_type': 'text'\\\\n			};\\\\n\\\\n			this.top_window=window.top;\\\\n			this.top_window=this.top_window.top;\\\\n\\\\n			for (var key in defaults) {\\\\n				this[key]=(typeof options[key]!='undefined')?options[key]:defaults[key];\\\\n			}\\\\n\\\\n			this.close(this.top_window);\\\\n			this.init_box();\\\\n		},\\\\n\\\\n		close: function(win) {\\\\n			if (this.box_wrapper) {\\\\n				this.top_window.document.body.style.overflow='';\\\\n\\\\n				this.remove(this.box_wrapper,win);\\\\n				this.box_wrapper=null;\\\\n\\\\n				this.remove_event(document,'keyup',this.keyup);\\\\n				this.remove_event(document,'mousemove',this.keyup);\\\\n			}\\\\n			this.opened=false;\\\\n		},\\\\n\\\\n		option: function(method) {\\\\n			var win=this.top_window; // The below call may end up killing our window reference (for nested alerts), so we need to grab it first\\\\n			if (this[ method ]) {\\\\n				if (this.type=='prompt') {\\\\n					this[ method ](this.input.value);\\\\n				}\\\\n				else if (this.type=='iframe') {\\\\n					this[ method ](this.returnValue);\\\\n				}\\\\n				else this[ method ]();\\\\n			}\\\\n			if (method!='left' && method!='right')\\\\n				this.close(win);\\\\n		},\\\\n\\\\n		reset_dimensions: function(width,height,init,force_height) {\\\\n			if (typeof force_height=='undefined') force_height=false;\\\\n\\\\n			if (!this.box_wrapper) return;\\\\n\\\\n			var dim=this.get_page_size();\\\\n\\\\n			var bottom_gap=this.WINDOW_TOP_GAP;\\\\n			if (this.button_container.childNodes.length>0) bottom_gap+=find_height(this.button_container);\\\\n\\\\n			if (!force_height)\\\\n				height='auto'; // Actually we always want auto heights, no reason to not for overlays\\\\n\\\\n			// Store for later (when browser resizes for example)\\\\n			this.width=width;\\\\n			this.height=height;\\\\n\\\\n			// Normalise parameters (we don't have px on the end of pixel units, and these units refer to internal space size [% ones are relative to window though])\\\\n			width=width.replace(/px\\\\\\\$/,'');\\\\n			height=height.replace(/px\\\\\\\$/,'');\\\\n\\\\n			// Constrain to window width\\\\n			if (width.match(/^\\\\\\\\d+\\\\\\\$/)!==null)\\\\n			{\\\\n				if ((window.parseInt(width)>dim.window_width-this.WINDOW_SIDE_GAP*2-this.BOX_EAST_PERIPHERARY-this.BOX_WEST_PERIPHERARY) || (width=='auto'))\\\\n					width=''+(dim.window_width-this.WINDOW_SIDE_GAP*2-this.BOX_EAST_PERIPHERARY-this.BOX_WEST_PERIPHERARY);\\\\n			}\\\\n\\\\n			// Auto width means full width\\\\n			if (width=='auto')\\\\n			{\\\\n				width=''+(dim.window_width-this.WINDOW_SIDE_GAP*2-this.BOX_EAST_PERIPHERARY-this.BOX_WEST_PERIPHERARY);\\\\n			}\\\\n			// NB: auto height feeds through without a constraint (due to infinite growth space), with dynamic adjustment for iframes\\\\n\\\\n			// Calculate percentage sizes\\\\n			var match;\\\\n			match=width.match(/^([\\\\\\\\d\\\\\\\\.]+)%\\\\\\\$/);\\\\n			if (match!==null)\\\\n			{\\\\n				width=''+(window.parseFloat(match[1])*(dim.window_width-this.WINDOW_SIDE_GAP*2-this.BOX_EAST_PERIPHERARY-this.BOX_WEST_PERIPHERARY));\\\\n			}\\\\n			match=height.match(/^([\\\\\\\\d\\\\\\\\.]+)%\\\\\\\$/);\\\\n			if (match!==null)\\\\n			{\\\\n				height=''+(window.parseFloat(match[1])*(dim.page_height-this.WINDOW_TOP_GAP-bottom_gap-this.BOX_NORTH_PERIPHERARY-this.BOX_SOUTH_PERIPHERARY));\\\\n			}\\\\n\\\\n			// Work out box dimensions\\\\n			var box_width,box_height;\\\\n			if (width.match(/^\\\\\\\\d+\\\\\\\$/)!==null)\\\\n			{\\\\n				box_width=width+'px';\\\\n			} else\\\\n			{\\\\n				box_width=width;\\\\n			}\\\\n			if (height.match(/^\\\\\\\\d+\\\\\\\$/)!==null)\\\\n			{\\\\n				box_height=height+'px';\\\\n			} else\\\\n			{\\\\n				box_height=height;\\\\n			}\\\\n\\\\n			// Save into HTML\\\\n			var detected_box_height;\\\\n			this.box_wrapper.childNodes[0].style.width=box_width;\\\\n			this.box_wrapper.childNodes[0].style.height=box_height;\\\\n			var iframe=this.box_wrapper.getElementsByTagName('iframe');\\\\n			if ((has_iframe_ownership(iframe[0])) && (iframe[0].contentWindow.document.body)) // Balance iframe height\\\\n			{\\\\n				iframe[0].style.width='100%';\\\\n				if (height=='auto')\\\\n				{\\\\n					if (!init)\\\\n					{\\\\n						detected_box_height=get_window_scroll_height(iframe[0].contentWindow);\\\\n						iframe[0].style.height=detected_box_height+'px';\\\\n					}\\\\n				} else\\\\n				{\\\\n					iframe[0].style.height='100%';\\\\n				}\\\\n			}\\\\n\\\\n			// Work out box position\\\\n			if (!detected_box_height) detected_box_height=find_height(this.box_wrapper.childNodes[0]);\\\\n			var _box_pos_top,_box_pos_left,box_pos_top,box_pos_left;\\\\n			if (box_height=='auto')\\\\n			{\\\\n				if (init)\\\\n				{\\\\n					_box_pos_top=(dim.window_height/(2+(this.VCENTRE_FRACTION_SHIFT*2)))-(this.LOADING_SCREEN_HEIGHT/2)+this.WINDOW_TOP_GAP; // This is just temporary\\\\n				} else\\\\n				{\\\\n					_box_pos_top=(dim.window_height/(2+(this.VCENTRE_FRACTION_SHIFT*2)))-(detected_box_height/2)+this.WINDOW_TOP_GAP;\\\\n				}\\\\n\\\\n				if (typeof iframe[0]!='undefined') _box_pos_top=this.WINDOW_TOP_GAP; // Actually, for frames we'll put at top so things don't bounce about during loading and if the frame size changes\\\\n			} else\\\\n			{\\\\n				_box_pos_top=(dim.window_height/(2+(this.VCENTRE_FRACTION_SHIFT*2)))-(parseInt(box_height)/2)+this.WINDOW_TOP_GAP;\\\\n			}\\\\n			if (_box_pos_top<this.WINDOW_TOP_GAP) _box_pos_top=this.WINDOW_TOP_GAP;\\\\n			_box_pos_left=((dim.window_width/2)-(parseInt(box_width)/2));\\\\n			box_pos_top=_box_pos_top+'px';\\\\n			box_pos_left=_box_pos_left+'px';\\\\n\\\\n			// Save into HTML\\\\n			this.box_wrapper.childNodes[0].style.top=box_pos_top;\\\\n			this.box_wrapper.childNodes[0].style.left=box_pos_left;\\\\n\\\\n			var do_scroll=false;\\\\n\\\\n			// Absolute positioning instead of fixed positioning\\\\n			if (('\\\".ecv_MOBILE(\\\$cl,array(),array()).\\\"'==1) || (detected_box_height>dim.window_height) || (this.box_wrapper.style.position=='absolute'/*don't switch back to fixed*/))\\\\n			{\\\\n				var was_fixed=(this.box_wrapper.style.position=='fixed');\\\\n\\\\n				this.box_wrapper.style.position='absolute';\\\\n				this.box_wrapper.style.height=((dim.page_height>(detected_box_height+bottom_gap+_box_pos_left))?dim.page_height:(detected_box_height+bottom_gap+_box_pos_left))+'px';\\\\n				this.top_window.document.body.style.overflow='';\\\\n				\\\".((ecv_NOT(\\\$cl,array(),array(ecv_MOBILE(\\\$cl,array(),array())))==\\\"1\\\")?(\\\"\\\\n					this.box_wrapper.childNodes[0].style.position='absolute';\\\\n					box_pos_top=\\\".(((ecv_MOBILE(\\\$cl,array(),array()))==\\\"1\\\")?(\\\"0\\\"):(\\\"this.WINDOW_TOP_GAP\\\")).\\\"+'px';\\\\n					this.box_wrapper.childNodes[0].style.top=box_pos_top;\\\\n				\\\"):'').\\\"\\\\n				\\\".((ecv_MOBILE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n					\\\\n				\\\"):'').\\\"\\\\n\\\\n				if ((init) || (was_fixed)) do_scroll=true;\\\\n				if (/*maybe a navigation has happened and we need to scroll back up*/(typeof iframe[0]!='undefined') && (has_iframe_ownership(iframe[0])) && (typeof iframe[0].contentWindow.scrolled_up_for=='undefined'))\\\\n				{\\\\n					do_scroll=true;\\\\n				}\\\\n			} else // Fixed positioning, with scrolling turned off until the overlay is closed\\\\n			{\\\\n				this.box_wrapper.style.position='fixed';\\\\n				this.box_wrapper.childNodes[0].style.position='fixed';\\\\n				this.top_window.document.body.style.overflow='hidden';\\\\n			}\\\\n\\\\n			if (do_scroll)\\\\n			{\\\\n				try // Scroll to top to see\\\\n				{\\\\n					this.top_window.scrollTo(0,0);\\\\n					if ((typeof iframe[0]!='undefined') && (has_iframe_ownership(iframe[0])))\\\\n						iframe[0].contentWindow.scrolled_up_for=true;\\\\n				}\\\\n				catch (e) {}\\\\n			}\\\\n		},\\\\n\\\\n		init_box: function() {\\\\n			var dim=this.get_page_size();\\\\n\\\\n			this.box_wrapper=this.element('div',{ // Black out the background\\\\n				'styles': {\\\\n					'background': 'rgba(0,0,0,0.7)',\\\\n					'zIndex': this.top_window.overlay_zIndex++,\\\\n					'overflow': 'hidden',\\\\n					'position': '\\\".(((ecv_MOBILE(\\\$cl,array(),array()))==\\\"1\\\")?(\\\"absolute\\\"):(\\\"fixed\\\")).\\\"',\\\\n					'left': '0',\\\\n					'top': '0',\\\\n					'width': '100%',\\\\n					'height': '100%'\\\\n				}\\\\n			});\\\\n\\\\n			this.box_wrapper.appendChild(this.element('div',{ // The main overlay\\\\n				'class': 'box overlay '+this.type,\\\\n				'role': 'dialog',\\\\n				'styles': {\\\\n					// This will be updated immediately in reset_dimensions\\\\n					'position': '\\\".(((ecv_MOBILE(\\\$cl,array(),array()))==\\\"1\\\")?(\\\"static\\\"):(\\\"fixed\\\")).\\\"',\\\\n					'margin': '0 auto' // Centering for iOS/Android which is statically positioned (so the container height as auto can work)\\\\n				}\\\\n			}));\\\\n\\\\n			var _this=this;\\\\n			var width=this.width;\\\\n			var height=this.height;\\\\n\\\\n			this.inject(this.box_wrapper);\\\\n\\\\n			var container=this.element('div',{\\\\n				'class': 'box_inner',\\\\n				'styles': {\\\\n					'width': 'auto',\\\\n					'height': 'auto'\\\\n				}\\\\n			});\\\\n\\\\n			var overlay_header=null;\\\\n			if (this.title!='' || this.type=='iframe') {\\\\n				overlay_header=this.element('h3',{\\\\n					'html': this.title,\\\\n					'styles': {\\\\n						'display': (this.title=='')?'none':'block'\\\\n					}\\\\n				});\\\\n				container.appendChild(overlay_header);\\\\n			}\\\\n\\\\n			if (this.text!='') {\\\\n				if (this.type=='prompt')\\\\n				{\\\\n					var div=this.element('p');\\\\n					div.appendChild(this.element('label',{\\\\n						'for': 'overlay_prompt',\\\\n						'html': this.text\\\\n					}));\\\\n					container.appendChild(div);\\\\n				} else\\\\n				{\\\\n					container.appendChild(this.element('div',{\\\\n						'html': this.text\\\\n					}));\\\\n				}\\\\n			}\\\\n\\\\n			this.button_container=this.element('p',{\\\\n				'class': 'proceed_button'\\\\n			});\\\\n\\\\n			var _this=this;\\\\n\\\\n			this.clickout_cancel=function() {\\\\n				_this.option('cancel');\\\\n			};\\\\n\\\\n			this.clickout_finished=function() {\\\\n				_this.option('finished');\\\\n			};\\\\n\\\\n			this.clickout_yes=function() {\\\\n				_this.option('yes');\\\\n			};\\\\n\\\\n			this.keyup=function(e) {\\\\n				if (!e) e=window.event;\\\\n				var key_code=(e)?(e.which || e.keyCode):null;\\\\n\\\\n				if (key_code==37) // Left arrow\\\\n				{\\\\n					_this.option('left');\\\\n				} else\\\\n				if (key_code==39) // Right arrow\\\\n				{\\\\n					_this.option('right');\\\\n				} else\\\\n				if ((key_code==13/*enter*/) && (_this.yes))\\\\n				{\\\\n					_this.option('yes');\\\\n				}\\\\n				if ((key_code==13/*enter*/) && (_this.finished))\\\\n				{\\\\n					_this.option('finished');\\\\n				} else if ((key_code==27/*esc*/) && (_this.cancel_button) && ((_this.type=='prompt') || (_this.type=='confirm') || (_this.type=='lightbox') || (_this.type=='alert')))\\\\n				{\\\\n					_this.option('cancel');\\\\n				}\\\\n			};\\\\n\\\\n			this.mousemove=function(e) {\\\\n				if (!e) e=window.event;\\\\n				if (_this.box_wrapper && _this.box_wrapper.childNodes[0].className.indexOf(' mousemove')==-1)\\\\n				{\\\\n					_this.box_wrapper.childNodes[0].className+=' mousemove';\\\\n					window.setTimeout(function() {\\\\n						if (_this.box_wrapper)\\\\n						{\\\\n							_this.box_wrapper.childNodes[0].className=_this.box_wrapper.childNodes[0].className.replace(/ mousemove/g,'');\\\\n						}\\\\n					},2000);\\\\n				}\\\\n			};\\\\n\\\\n			this.add_event(this.box_wrapper.childNodes[0],'click',function(e) {\\\\n				try { _this.top_window.cancel_bubbling(e); } catch (e) {}\\\\n				\\\".((ecv_MOBILE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n					if (_this.type=='lightbox') // IDEA: Swipe detect would be better, but JS does not have this natively yet\\\\n					{\\\\n						_this.option('right');\\\\n					}\\\\n				\\\"):'').\\\"\\\\n			});\\\\n\\\\n			switch (this.type)\\\\n			{\\\\n				case 'iframe':\\\\n					var iframe_width=(this.width.match(/^[\\\\\\\\d\\\\\\\\.]+\\\\\\\$/)!==null)?((this.width-14)+'px'):this.width;\\\\n					var iframe_height=(this.height.match(/^[\\\\\\\\d\\\\\\\\.]+\\\\\\\$/)!==null)?(this.height+'px'):((this.height=='auto')?(this.LOADING_SCREEN_HEIGHT+'px'):this.height);\\\\n\\\\n					var iframe=this.element('iframe',{\\\\n						'frameBorder': '0',\\\\n						'scrolling': 'no',\\\\n						'title': '',\\\\n						'name': 'overlay_iframe',\\\\n						'id': 'overlay_iframe',\\\\n						'allowTransparency': 'true',\\\\n						//'seamless': 'seamless',	Not supported, and therefore testable yet. Would be great for mobile browsing.\\\\n						'styles': {\\\\n							'width': iframe_width,\\\\n							'height': iframe_height,\\\\n							'background': 'transparent'\\\\n						}\\\\n					});\\\\n\\\\n					container.appendChild(iframe);\\\\n\\\\n					animate_frame_load(iframe,'overlay_iframe',50,true);\\\\n\\\\n					window.setTimeout(function() { _this.add_event(_this.box_wrapper,'click',_this.clickout_finished); },1000);\\\\n\\\\n					this.add_event(iframe,'load',function() {\\\\n						if ((has_iframe_ownership(iframe)) && (typeof iframe.contentWindow.document.getElementsByTagName('h1')[0]=='undefined') && (typeof iframe.contentWindow.document.getElementsByTagName('h2')[0]=='undefined'))\\\\n						{\\\\n							if (iframe.contentWindow.document.title!='')\\\\n							{\\\\n								set_inner_html(overlay_header,escape_html(iframe.contentWindow.document.title));\\\\n								overlay_header.style.display='block';\\\\n							}\\\\n						}\\\\n					});\\\\n\\\\n					// Fiddle it, to behave like a popup would\\\\n					var name=this.name;\\\\n					var make_frame_like_popup=function() {\\\\n						if (iframe.parentNode.parentNode.parentNode.parentNode==null && _this.iframe_restyle_timer!=null)\\\\n						{\\\\n							clearInterval(_this.iframe_restyle_timer);\\\\n							_this.iframe_restyle_timer=null;\\\\n							return;\\\\n						}\\\\n\\\\n						if ((has_iframe_ownership(iframe)) && (iframe.contentWindow.document.body) && (typeof iframe.contentWindow.document.body.done_popup_trans=='undefined'))\\\\n						{\\\\n							iframe.contentWindow.document.body.style.background='transparent';\\\\n\\\\n							if (iframe.contentWindow.document.body.className.indexOf('overlay')==-1)\\\\n								iframe.contentWindow.document.body.className+=' overlay lightbox';\\\\n\\\\n							// Allow scrolling, if we want it\\\\n							//iframe.scrolling=(_this.scrollbars===false)?'no':'auto';	Actually, not wanting this now\\\\n\\\\n							// Remove fixed width\\\\n							var main_website_inner=iframe.contentWindow.document.getElementById('main_website_inner');\\\\n							if (main_website_inner) main_website_inner.id='';\\\\n\\\\n							// Remove main_website marker\\\\n							var main_website=iframe.contentWindow.document.getElementById('main_website');\\\\n							if (main_website) main_website.id='';\\\\n\\\\n							// Remove popup spacing\\\\n							var popup_spacer=iframe.contentWindow.document.getElementById('popup_spacer');\\\\n							if (popup_spacer) popup_spacer.id='';\\\\n\\\\n							// Set linking scheme\\\\n							var bases=iframe.contentWindow.document.getElementsByTagName('base');\\\\n							var base_element;\\\\n							if (!bases[0])\\\\n							{\\\\n								base_element=iframe.contentWindow.document.createElement('base');\\\\n								if (iframe.contentWindow.document)\\\\n								{\\\\n									var heads=iframe.contentWindow.document.getElementsByTagName('head');\\\\n									if (heads[0])\\\\n									{\\\\n										heads[0].appendChild(base_element);\\\\n									}\\\\n								}\\\\n							} else\\\\n							{\\\\n								base_element=bases[0];\\\\n							}\\\\n							base_element.target=_this.target;\\\\n							// Firefox 3.6 does not respect <base> element put in via DOM manipulation :(\\\\n							var forms=iframe.contentWindow.document.getElementsByTagName('form');\\\\n							for (var i=0;i<forms.length;i++)\\\\n							{\\\\n								if (!forms[i].target) forms[i].target=_this.target;\\\\n							}\\\\n							var as=iframe.contentWindow.document.getElementsByTagName('a');\\\\n							for (var i=0;i<as.length;i++)\\\\n							{\\\\n								if (!as[i].target) as[i].target=_this.target;\\\\n							}\\\\n\\\\n							// Set frame name\\\\n							if (name && iframe.contentWindow.name!=name) iframe.contentWindow.name=name;\\\\n\\\\n							// Create close function\\\\n							if (typeof iframe.contentWindow.faux_close=='undefined')\\\\n							{\\\\n								iframe.contentWindow.faux_close=function() {\\\\n									if (iframe && iframe.contentWindow && typeof iframe.contentWindow.returnValue!='undefined')\\\\n										_this.returnValue=iframe.contentWindow.returnValue;\\\\n									_this.option('finished');\\\\n								};\\\\n							}\\\\n\\\\n							if (get_inner_html(iframe.contentWindow.document.body).length>300) // Loaded now\\\\n							{\\\\n								iframe.contentWindow.document.body.done_popup_trans=true;\\\\n							}\\\\n						} else\\\\n						{\\\\n							if (has_iframe_loaded(iframe) && !has_iframe_ownership(iframe)) {\\\\n								iframe.scrolling='yes';\\\\n								iframe.style.height='500px';\\\\n							}\\\\n						}\\\\n\\\\n						// Handle iframe sizing\\\\n						if (_this.height=='auto')\\\\n						{\\\\n							_this.reset_dimensions(_this.width,_this.height,false);\\\\n						}\\\\n					};\\\\n					window.setTimeout(function() {\\\\n						illustrate_frame_load(iframe,'overlay_iframe');\\\\n						iframe.src=_this.href;\\\\n						make_frame_like_popup();\\\\n\\\\n						if (_this.iframe_restyle_timer==null)\\\\n							_this.iframe_restyle_timer=window.setInterval(make_frame_like_popup,300); // In case internal nav changes\\\\n					},0);\\\\n					break;\\\\n\\\\n				case 'lightbox':\\\\n				case 'alert':\\\\n					if (this.yes)\\\\n					{\\\\n						var button=this.element('button',{\\\\n							'html': this.yes_button,\\\\n							'class': 'buttons__proceed button_screen_item'\\\\n						});\\\\n						this.add_event(button,'click',function() { _this.option('yes'); });\\\\n						window.setTimeout(function() { _this.add_event(_this.box_wrapper,'click',_this.clickout_yes); },1000);\\\\n						this.button_container.appendChild(button);\\\\n					} else\\\\n					{\\\\n						window.setTimeout(function() { _this.add_event(_this.box_wrapper,'click',_this.clickout_cancel); },1000);\\\\n					}\\\\n					break;\\\\n\\\\n				case 'confirm':\\\\n					var button=this.element('button',{\\\\n						'html': this.yes_button,\\\\n						'class': 'buttons__yes button_screen_item',\\\\n						'style': 'font-weight: bold;'\\\\n					});\\\\n					this.add_event(button,'click',function() { _this.option('yes'); });\\\\n					this.button_container.appendChild(button);\\\\n					var button=this.element('button',{\\\\n						'html': this.no_button,\\\\n						'class': 'buttons__no button_screen_item'\\\\n					});\\\\n					this.add_event(button,'click',function() { _this.option('no'); });\\\\n					this.button_container.appendChild(button);\\\\n					break;\\\\n\\\\n				case 'prompt':\\\\n					this.input=this.element('input',{\\\\n						'name': 'prompt',\\\\n						'id': 'overlay_prompt',\\\\n						'type': this.input_type,\\\\n						'size': '40',\\\\n						'class': 'wide_field',\\\\n						'value': (this.defaultValue===null)?'':this.defaultValue\\\\n					});\\\\n					var input_wrap=this.element('div',{\\\\n						'class': 'constrain_field'\\\\n					});\\\\n					input_wrap.appendChild(this.input);\\\\n					container.appendChild(input_wrap);\\\\n\\\\n					if (this.yes)\\\\n					{\\\\n						var button=this.element('button',{\\\\n							'html': this.yes_button,\\\\n							'class': 'buttons__yes button_screen_item',\\\\n							'style': 'font-weight: bold;'\\\\n						});\\\\n						this.add_event(button,'click',function() { _this.option('yes'); });\\\\n						this.button_container.appendChild(button);\\\\n					}\\\\n					window.setTimeout(function() { _this.add_event(_this.box_wrapper,'click',_this.clickout_cancel); },1000);\\\\n					break;\\\\n			}\\\\n\\\\n			// Cancel button handled either via button in corner (if there's no other buttons) or another button in the panel (if there's other buttons)\\\\n			if (this.cancel_button)\\\\n			{\\\\n				var button;\\\\n				if (this.button_container.childNodes.length>0)\\\\n				{\\\\n					button=this.element('button',{\\\\n						'html': this.cancel_button,\\\\n						'class': 'button_screen_item buttons__cancel'\\\\n					});\\\\n					this.button_container.appendChild(button);\\\\n				} else\\\\n				{\\\\n					button=this.element('img',{\\\\n						'src': '\\\".ecv_IMG(\\\$cl,array(2),array(\\\"button_lightbox_close\\\",\\\"0\\\",\\\"BeatGrid_CSM\\\")).\\\"'.replace(/^https?:/,window.location.protocol),\\\\n						'alt': this.cancel_button,\\\\n						'class': 'overlay_close_button'\\\\n					});\\\\n					container.appendChild(button);\\\\n				}\\\\n				this.add_event(button,'click',function() { _this.option(this.cancel?'cancel':'finished'); });\\\\n			}\\\\n\\\\n			// Put together\\\\n			if (this.button_container.childNodes.length>0)\\\\n			{\\\\n				if (this.type=='iframe')\\\\n					container.appendChild(this.element('hr',{ 'class': 'spaced_rule' }));\\\\n				container.appendChild(this.button_container);\\\\n			}\\\\n			this.box_wrapper.childNodes[0].appendChild(container);\\\\n\\\\n			// Handle dimensions\\\\n			this.reset_dimensions(this.width,this.height,true);\\\\n			this.add_event(window,'resize',function() { _this.reset_dimensions(width,height,false); });\\\\n\\\\n			// Focus first button by default\\\\n			if (this.input)\\\\n			{\\\\n				window.setTimeout(function() { _this.input.focus(); },0);\\\\n			}\\\\n			else if (typeof this.box_wrapper.getElementsByTagName('button')[0]!='undefined')\\\\n			{\\\\n				this.box_wrapper.getElementsByTagName('button')[0].focus();\\\\n			}\\\\n\\\\n			window.setTimeout(function() { // Timeout needed else keyboard activation of overlay opener may cause instant shutdown also\\\\n				_this.add_event(document,'keyup',_this.keyup);\\\\n				_this.add_event(document,'mousemove',_this.mousemove);\\\\n			},100);\\\\n		},\\\\n\\\\n		inject: function(el) {\\\\n			this.top_window.document.body.appendChild(el);\\\\n		},\\\\n\\\\n		remove: function(el,win) {\\\\n			if (!win) win=this.top_window;\\\\n			win.document.body.removeChild(el);\\\\n		},\\\\n\\\\n		element: function() {\\\\n			var tag=arguments[0],options=arguments[1];\\\\n			var el=this.top_window.document.createElement(tag);\\\\n			var attributes={\\\\n				'html': 'innerHTML',\\\\n				'class': 'className',\\\\n				'for': 'htmlFor',\\\\n				'text': 'innerText'\\\\n			};\\\\n			if (options)\\\\n			{\\\\n				if (typeof options=='object')\\\\n				{\\\\n					for (var name in options)\\\\n					{\\\\n						var value=options[name];\\\\n						if (name=='styles')\\\\n						{\\\\n							this.set_styles(el,value);\\\\n						} else if (name=='html')\\\\n						{\\\\n							set_inner_html(el,value);\\\\n						} else if (attributes[name])\\\\n						{\\\\n							el[attributes[name]]=value;\\\\n						} else\\\\n						{\\\\n							el.setAttribute(name,value);\\\\n						}\\\\n					}\\\\n				}\\\\n			}\\\\n			return el;\\\\n		},\\\\n\\\\n		add_event: function(o,e,f) {\\\\n			if (o)\\\\n			{\\\\n				if (o.addEventListener) o.addEventListener(e,f,false);\\\\n				else if (o.attachEvent) o.attachEvent('on'+e,f);\\\\n			}\\\\n		},\\\\n\\\\n		remove_event: function(o,e,f) {\\\\n			if (o)\\\\n			{\\\\n				if (o.removeEventListener) o.removeEventListener(e,f,false);\\\\n				else if (o.detachEvent) o.detachEvent('on'+e,f);\\\\n			}\\\\n		},\\\\n\\\\n		set_styles: function(e,o) {\\\\n			for (var k in o)\\\\n			{\\\\n				this.set_style(e,k,o[k]);\\\\n			}\\\\n		},\\\\n\\\\n		set_style: function(e,p,v) {\\\\n			if (p=='opacity')\\\\n			{\\\\n				this.top_window.set_opacity(e,v);\\\\n			} else\\\\n			{\\\\n				try\\\\n				{\\\\n					e.style[p]=v;\\\\n				}\\\\n				catch (e){}\\\\n			}\\\\n		},\\\\n\\\\n		get_page_size: function() {\\\\n			return {\\\\n				'page_width': this.top_window.get_window_scroll_width(this.top_window),\\\\n				'page_height': this.top_window.get_window_scroll_height(this.top_window),\\\\n				'window_width': this.top_window.get_window_width(this.top_window),\\\\n				'window_height': this.top_window.get_window_height()\\\\n			};\\\\n		}\\\\n	};\\\\n}\\\\n\\\"),\\n	\\\"\\\\n\\\";\");\";}}");

