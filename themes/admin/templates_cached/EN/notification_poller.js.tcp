<?php
return unserialize("a:5:{i:0;a:1:{i:0;a:1:{i:0;a:5:{i:0;s:33:\"tcpfunc_5abfd05eb3d9c2.05918652_1\";i:1;a:0:{}i:2;i:1;i:3;s:0:\"\";i:4;s:0:\"\";}}}i:1;a:0:{}i:2;s:19:\"notification_poller\";i:3;N;i:4;a:1:{s:33:\"tcpfunc_5abfd05eb3d9c2.05918652_1\";s:8458:\"\$tpl_funcs['tcpfunc_5abfd05eb3d9c2.05918652_1']=\$KEEP_TPL_FUNCS['tcpfunc_5abfd05eb3d9c2.05918652_1']=recall_named_function('5abfd05eb3dae0.39318244','\$parameters,\$cl',\"echo \\\"\\\\\\\"use strict\\\\\\\";\\\\n\\\\n/*\\\\nPoll for notifications (and unread PTs)\\\\n*/\\\\n\\\\nif (typeof window.notifications_time_barrier=='undefined')\\\\n{\\\\n	window.notifications_already_presented={};\\\\n\\\\n	window.NOTIFICATION_POLL_FREQUENCY=15;\\\\n\\\\n	window.notifications_time_barrier=0;\\\\n}\\\\n\\\\nfunction notification_poller_init(time_barrier)\\\\n{\\\\n	require_javascript('sound',window.SoundManager);\\\\n\\\\n	window.notifications_time_barrier=time_barrier;\\\\n\\\\n	window.setInterval(window.poll_for_notifications,window.NOTIFICATION_POLL_FREQUENCY*1000);\\\\n\\\\n	var web_notifications_button=document.getElementById('web_notifications_button');\\\\n	if (web_notifications_button)\\\\n		add_event_listener_abstract(web_notifications_button,'click',explicit_notifications_enable_request);\\\\n}\\\\n\\\\nfunction notifications_mark_all_read(event)\\\\n{\\\\n	var url='\\\",\\n	ecv_FIND_SCRIPT(\\\$cl,array(2),array(\\\"notifications\\\")),\\n	\\\"?type=poller&type=mark_all_read';\\\\n	if (typeof window.max_notifications_to_show!='undefined') url+='&max='+window.max_notifications_to_show;\\\\n	url+='&time_barrier='+window.encodeURIComponent(window.notifications_time_barrier);\\\\n	url+='&forced_update=1';\\\\n	url+=keep_stub();\\\\n	do_ajax_request(url,window._poll_for_notifications);\\\\n	_toggle_messaging_box(event,'web_notifications',true);\\\\n	return false;\\\\n}\\\\n\\\\nfunction poll_for_notifications(forced_update,delay)\\\\n{\\\\n	if (typeof forced_update=='undefined') forced_update=false;\\\\n	if (typeof delay=='undefined') delay=false;\\\\n\\\\n	if (delay)\\\\n	{\\\\n		window.setTimeout(function() {\\\\n			poll_for_notifications(forced_update);\\\\n		},1000);\\\\n		return;\\\\n	}\\\\n\\\\n	var url='\\\",\\n	ecv_FIND_SCRIPT(\\\$cl,array(2),array(\\\"notifications\\\")),\\n	\\\"?type=poller&type=poller';\\\\n	if (typeof window.max_notifications_to_show!='undefined') url+='&max='+window.max_notifications_to_show;\\\\n	url+='&time_barrier='+window.encodeURIComponent(window.notifications_time_barrier);\\\\n	if (forced_update) url+='&forced_update=1';\\\\n	url+=keep_stub();\\\\n	do_ajax_request(url,window._poll_for_notifications);\\\\n}\\\\n\\\\nfunction _poll_for_notifications(raw_ajax_result)\\\\n{\\\\n	if (typeof raw_ajax_result.getElementsByTagName=='undefined')\\\\n		return; // Some kind of error\\\\n\\\\n	var time_node=raw_ajax_result.getElementsByTagName('time')[0];\\\\n	window.notifications_time_barrier=window.parseInt(get_inner_html(time_node));\\\\n\\\\n	// HTML5 notification API\\\\n\\\\n	var alerts;\\\\n\\\\n	alerts=raw_ajax_result.getElementsByTagName('web_notification');\\\\n	for (var i=0;i<alerts.length;i++)\\\\n	{\\\\n		display_alert(alerts[i]);\\\\n	}\\\\n\\\\n	alerts=raw_ajax_result.getElementsByTagName('pt');\\\\n	for (var i=0;i<alerts.length;i++)\\\\n	{\\\\n		display_alert(alerts[i]);\\\\n	}\\\\n\\\\n	// Show in the software directly, if possible\\\\n\\\\n	var spot,display,button,unread;\\\\n\\\\n	spot=document.getElementById('web_notifications_spot');\\\\n	if (spot)\\\\n	{\\\\n		display=raw_ajax_result.getElementsByTagName('display_web_notifications');\\\\n		button=document.getElementById('web_notifications_button');\\\\n		if ((typeof display[0]!='undefined') && (display[0]))\\\\n		{\\\\n			unread=raw_ajax_result.getElementsByTagName('unread_web_notifications');\\\\n			set_inner_html(spot,get_inner_html(display[0]));\\\\n			set_inner_html(button.childNodes[0],get_inner_html(unread[0]));\\\\n			button.className='count_'+get_inner_html(unread[0]);\\\\n		}\\\\n	}\\\\n\\\\n	spot=document.getElementById('pts_spot');\\\\n	if (spot)\\\\n	{\\\\n		display=raw_ajax_result.getElementsByTagName('display_pts');\\\\n		button=document.getElementById('pts_button');\\\\n		if ((typeof display[0]!='undefined') && (display[0]))\\\\n		{\\\\n			unread=raw_ajax_result.getElementsByTagName('unread_pts');\\\\n			set_inner_html(spot,get_inner_html(display[0]));\\\\n			set_inner_html(button.childNodes[0],get_inner_html(unread[0]));\\\\n			button.className='count_'+get_inner_html(unread[0]);\\\\n		}\\\\n	}\\\\n}\\\\n\\\\nfunction display_alert(notification)\\\\n{\\\\n	var id=notification.getAttribute('id');\\\\n\\\\n	if (typeof window.notifications_already_presented[id]!='undefined') return; // Already handled this one\\\\n\\\\n	// Play sound, if requested\\\\n	var sound=notification.getAttribute('sound');\\\\n	if (!sound) sound=(window.parseInt(notification.getAttribute('priority'))<3)?'on':'off';\\\\n	if (read_cookie('sound','off')==='off') sound='off';\\\\n	var notification_code=notification.getAttribute('notification_code');\\\\n	if (sound=='on' && typeof window.detect_change=='undefined' || notification_code!='ticket_reply' && notification_code!='ticket_reply_staff')\\\\n	{\\\\n		if (typeof window.soundManager!='undefined')\\\\n		{\\\\n			var go_func=function() {\\\\n				var sound_url='data/sounds/message_received.mp3';\\\\n				var base_url=((sound_url.indexOf('data_custom')==-1)&&(sound_url.indexOf('uploads/')==-1))?'':'https://csm.wearebeatgrid.com';\\\\n				var sound_object=window.soundManager.createSound({url: base_url+'/'+sound_url});\\\\n				if (sound_object && document.hasFocus()/*don't want multiple tabs all pinging*/) sound_object.play();\\\\n			};\\\\n\\\\n			if (!window.soundManager.setupOptions.url)\\\\n			{\\\\n				window.soundManager.setup({onready: go_func, url: get_base_url()+'/data/soundmanager', debugMode: false});\\\\n			} else\\\\n			{\\\\n				go_func();\\\\n			}\\\\n		}\\\\n	}\\\\n\\\\n	// Show desktop notification\\\\n	\\\\n\\\\n	// Mark done\\\\n	window.notifications_already_presented[id]=true;\\\\n}\\\\n\\\\n// We attach to an onclick handler, to enable desktop notifications later on; we need this as we cannot call requestPermission out of the blue\\\\nfunction explicit_notifications_enable_request()\\\\n{\\\\n	\\\\n}\\\\n\\\\nfunction toggle_top_personal_stats(event)\\\\n{\\\\n	if (typeof event=='undefined') event=window.event;\\\\n	_toggle_messaging_box(event,'pts',true);\\\\n	_toggle_messaging_box(event,'web_notifications',true);\\\\n	return _toggle_messaging_box(event,'top_personal_stats');\\\\n}\\\\n\\\\nfunction toggle_web_notifications(event)\\\\n{\\\\n	if (typeof event=='undefined') event=window.event;\\\\n	_toggle_messaging_box(event,'top_personal_stats',true);\\\\n	_toggle_messaging_box(event,'pts',true);\\\\n	return _toggle_messaging_box(event,'web_notifications');\\\\n}\\\\n\\\\nfunction toggle_pts(event)\\\\n{\\\\n	if (typeof event=='undefined') event=window.event;\\\\n	_toggle_messaging_box(event,'top_personal_stats',true);\\\\n	_toggle_messaging_box(event,'web_notifications',true);\\\\n	return _toggle_messaging_box(event,'pts');\\\\n}\\\\n\\\\nfunction _toggle_messaging_box(event,name,hide)\\\\n{\\\\n	if (typeof hide=='undefined') hide=false;\\\\n\\\\n	var e=document.getElementById(name+'_rel');\\\\n	if (!e) return;\\\\n\\\\n	event.within_message_box=true;\\\\n	cancel_bubbling(event);\\\\n\\\\n	var body=document.body;\\\\n	if (e.parentNode!=body) // Move over, so it is not cut off by overflow:hidden of the header\\\\n	{\\\\n		e.parentNode.removeChild(e);\\\\n		body.appendChild(e);\\\\n\\\\n		add_event_listener_abstract(e,'click',function(event) { if (typeof event=='undefined') event=window.event; event.within_message_box=true; });\\\\n		add_event_listener_abstract(body,'click',function(event) { if (typeof event=='undefined') event=window.event; if (typeof event.within_message_box!='undefined') return; _toggle_messaging_box(event,'top_personal_stats',true); _toggle_messaging_box(event,'web_notifications',true); _toggle_messaging_box(event,'pts',true); });\\\\n	}\\\\n\\\\n	var button=document.getElementById(name+'_button');\\\\n	button.title='';\\\\n	var set_position=function() {\\\\n		var button_x=find_pos_x(button,true);\\\\n		var button_width=find_width(button);\\\\n		var x=(button_x+button_width-find_width(e));\\\\n		if (x<0)\\\\n		{\\\\n			var span=e.getElementsByTagName('span')[0];\\\\n			span.style.marginLeft=(button_x+button_width/4)+'px';\\\\n			x=0;\\\\n		}\\\\n		e.style.left=x+'px';\\\\n		e.style.top=(find_pos_y(button,true)+find_height(button))+'px';\\\\n		try\\\\n		{\\\\n			e.style.opacity='1.0';\\\\n		}\\\\n		catch (ex) {}\\\\n	};\\\\n	window.setTimeout(set_position,0);\\\\n\\\\n	if ((e.style.display=='none') && (!hide))\\\\n	{\\\\n		var tooltips=document.querySelectorAll('body>.tooltip');\\\\n		if (typeof tooltips[0]!='undefined')\\\\n			tooltips[0].style.display='none'; // Hide tooltip, to stop it being a mess\\\\n\\\\n		e.style.display='inline';\\\\n	} else\\\\n	{\\\\n		e.style.display='none';\\\\n	}\\\\n	try\\\\n	{\\\\n		e.style.opacity='0.0'; // Render, but invisibly, until we've positioned it\\\\n	}\\\\n	catch (ex) {}\\\\n\\\\n	return false;\\\\n}\\\\n\\\\n\\\\n\\\";\");\";}}");

